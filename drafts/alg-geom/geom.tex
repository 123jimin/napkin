\documentclass[11pt]{scrreprt}
\input{../../tex/preamble}
\def\asydir{}
\addbibresource{../../references.bib}
\renewcommand{\gim}{*}
\renewcommand{\yod}{**}
\renewcommand{\kurumi}{***}

\begin{document}
\title{Algebraic Geometry}
\maketitle

\chapter{Affine Varieties}
In this chapter we introduce affine varieties.
We introduce them in the context of coordinates,
but over the course of the other chapters
we'll gradually move away from this perspective to
viewing varieties as ``intrinsic objects'',
rather than embedded in coordinates.

For simplicity, we'll do almost everything over the field of complex numbers,
but the discussion generalizes to any algebraically closed field.

\section{Affine Varieties}
\prototype{$\VV(y-x^2)$ is a parabola.}
%An \vocab{affine variety} is just the zero locus of a set of polynomials.
%We think of it as living in the $n$-dimensional space $\Aff^n$.

\begin{definition}
	Given a set of polynomials $S \subset \CC[x_1, \dots, x_n]$
	(not necessarily finite or even countable),
	we let $\VV(S)$ denote the set of points vanishing on \emph{all}
	the polynomials in $S$.
	Such a set is called an \vocab{affine variety}.
	It lives in \vocab{$n$-dimensional affine space}, denoted $\Aff^n$
	(to distinguish it from projective space later).
\end{definition}
For example, a parabola is the zero locus of the polynomial $\VV(y-x^2)$. Picture:
\begin{center}
	\begin{asy}
		import graph;
		size(5cm);

		real f(real x) { return x*x; }
		graph.xaxis("$x$");
		graph.yaxis("$y$");
		draw(graph(f,-2,2,operator ..), blue, Arrows);
		label("$\mathcal V(y-x^2)$", (0.8, f(0.8)), dir(-45), blue);
		label("$\mathbb A^2$", (2,3), dir(45));
	\end{asy}
\end{center}

\begin{example}[Examples of Affine Varieties]
	These examples are in two-dimensional space $\Aff^2$,
	whose points are pairs $(x,y)$.
	\begin{enumerate}[(a)]
	\ii A straight line can be thought of as $\VV(Ax + By + C)$.
	\ii A parabola as above can be pictured as $\VV(y-x^2)$.
	\ii A hyperbola might be the zero locus of the polynomial $\VV(xy-1)$.
	\ii The two axes can be thought of as $\VV(xy)$; this is the set of points
	such that $x=0$ \emph{or} $y=0$.
	\ii A point $(x_0, y_0)$ can be thought of as $\VV(x-x_0, y-y_0)$.
	\ii The entire space $\Aff^2$ can be thought of as $\VV(0)$.
	\ii The empty set is the zero locus of the constant polynomial $1$, that is $\VV(1)$.
	\end{enumerate}
\end{example}

\section{Naming Affine Varieties via Ideals}
\prototype{$\VV(I)$ is a parabola, where $I=(y-x^2)$.}
As you might have already noticed, a variety can be named by $\VV(-)$ in multiple ways.
For example, the set of solutions to
\[ x=3 \text{ and } y=4 \]
is just the point $(3,4)$.
But this is also the set of solutions to
\[ x=3 \text{ and } y=x+1. \]
So, for example
\[ \{(3,4)\}
	= \VV(x-3, y-4)
	= \VV(x-3, y-x-1).
	\]
That's a little annoying, because in an ideal world we would have \emph{one} name
for every variety.
Let's see if we can achieve this.

A partial solution is to use \emph{ideals} rather than small sets.
That is, consider the ideal
\[
	I = \left( x-3, y-4 \right)
	= \left\{ p(x,y) \cdot (x-3) + q(x,y) \cdot (y-4)
	\mid p,q \in \CC[x,y] \right\}
\]
and look at $\VV(I)$.
\begin{ques}
	Convince yourself that $\VV(I) = \{(3,4)\}$.
\end{ques}
So rather than writing $\VV(x-3, y-4)$ it makes sense to
think about this as $\VV\left( I \right)$, where $I = (x-3,y-4)$ is the \emph{ideal}
generated by the two polynomials $x-3$ and $y-4$.
This is an improvement because
\begin{ques}
	Check that $(x-3, y-x-1) = (x-3, y-4)$.
\end{ques}

Needless to say, this pattern holds in general.
\begin{ques}
	Let $\{f_i\}$ be a set of polynomials, and consider
	the ideal $I$ generated by these $\{f_i\}$.
	Show that $\VV(\{f_i\}) = \VV(I)$.
\end{ques}

Thus we will only consider $\VV(I)$ when $I$ is an ideal.
Of course, frequently our ideals are generated by one or two polynomials,
so we will make the following abuse.
\begin{abuse}
	Given a set of polynomials $f_1, \dots, f_m$
	we let $\VV(f_1, \dots, f_m)$ be shorthand for
	$\VV\left( \left( f_1, \dots, f_m \right) \right)$.
	In other words we let $\VV(f_1, \dots, f_m)$
	abbreviate $\VV(I)$, where $I$ is the \emph{ideal} $I=(f_1, \dots, f_m)$.
\end{abuse}

This is where the Noetherian condition really shines:
it guarantees that every ideal $I \subseteq \CC[x_1, \dots, x_n]$
can be written in the form above with \emph{finitely} many polynomials,
because it is \emph{finitely generated}.
(The fact that $\CC[x_1, \dots, x_n]$ is Noetherian follows from the Hilbert Basis Theorem,
which is \todo{link}).
This is a relief, because dealing with infinite sets of polynomials is not much fun.

\section{Radical Ideals and Hilbert's Nullstellensatz}
\prototype{$\sqrt{(x^2)} = (x)$ in $\CC[x]$, $\sqrt{(12)} = (6)$ in $\ZZ$.}
You might ask whether the name is unique now:
that is, if $\VV(I) = \VV(J)$, does it follow that $I=J$?
The answer is unfortunately no: the counterexample can be found in just $\Aff^1$.
It is
\[ \VV(x) = \VV(x^2). \]
In other words, the set of solutions to $x=0$ is the same as the set of solutions to $x^2=0$.

Well, that's stupid.
We want an operation which takes the ideal $(x^2)$ and makes it into the ideal $(x)$.
The way to do so is using the radical of an ideal.

\begin{definition}
	Let $R$ be a ring.
	The \vocab{radical} of an ideal $I \subseteq R$, denoted $\sqrt I$,
	is defined by
	\[
		\sqrt I =
		\left\{ r \in R
			\mid r^m \in I \text{ for some integer $m \ge 1$}  \right\}. 
	\]
\end{definition}
For example, $\sqrt{(x^2)} = (x)$.
You may like to take the time to verify that $\sqrt I$ is actually an ideal.

This is actually the same as the notion of ``radical'' in number theory.
In $\ZZ$, the radical of an ideal $(n)$ corresponds to just
removing all the duplicate prime factors, so for example
\[ \sqrt{(12)} = (6). \]
In particular, if you try to take $\sqrt{(6)}$, you just get $(6)$ back;
you don't squeeze out any new prime factors.
And that's true in general.

\begin{definition}
	An ideal $I$ is called \vocab{semiprime} if $\sqrt I = I$.
\end{definition}
\begin{ques}
	Show that $\sqrt I$ is always semiprime.
\end{ques}
\begin{remark}
	As the name suggests, prime ideals are semiprime.
	You're welcome to try and prove this (easy exercise).
\end{remark}
Sometimes useful equivalent definition
(which is more in line with the number theory definition):
\begin{theorem}[Radical is Intersection of Prime Ideals]
	For any ideal $I$, we have
	\[ \sqrt I = \bigcap_{I \subseteq \pp \text{ prime}} \pp. \]
\end{theorem}

In any case, we have the following.
\begin{ques}
	Verify that $\VV(I) = \VV(\sqrt I)$.
\end{ques}
This makes sense: you would never refer to $x=0$ as $x^2=0$.
With this, we obtain a theorem called Hilbert's Nullstellensatz.
\begin{theorem}[Hilbert's Nullstellensatz]
	Given an affine variety $V = \VV(I)$, the set of polynomials which vanish
	on all points of $V$ is precisely $\sqrt I$.
	Thus if $I$ and $J$ are ideals in $\CC[x_1, \dots, x_n]$,
	then \[ \VV(I) = \VV(J) \text{ if and only if $\sqrt I = \sqrt J$}. \]
\end{theorem}
In other words
\begin{moral}
	Semiprime ideals in $\CC[x_1, \dots, x_n]$ correspond
	exactly to $n$-dimensional affine varieties.
\end{moral}
The proof of Hilbert's Nullestellensatz will be given later;
it \emph{relies essentially on the fact that $\CC$ is algebraically closed}.
For example, it is false in $\RR[x]$,
with $(x^2+1)$ being a maximal ideal with empty vanishing set.

\section{Pictures of Varieties in $\Aff^1$}
\prototype{Finite sets of points (in fact these are the only nontrivial examples).}
Let's first draw some pictures.
In what follows I'll draw $\CC$ as a straight line\dots sorry.

First of all, let's look at just the complex line $\Aff^1$.
What are the various varieties on it?
For starters, we have a single point $9 \in \CC$,
generated by $(x-9)$.

\begin{center}
	\begin{asy}
		size(6cm);
		pair A = (-9,0); pair B = (9,0);
		draw(A--B, Arrows);
		label("$\mathcal V(x-9)$", (0,0), 2*dir(-90));
		dot("$9$", (3,0), dir(90));
		label("$\mathbb A^1$", A+(2,0), dir(90));
	\end{asy}
\end{center}

Another example is the point $4$.
And in fact, if we like we can get an ideal consisting of just these two points;
consider $\VV\left( (x-4)(x-9) \right)$.

\begin{center}
	\begin{asy}
		size(6cm);
		pair A = (-9,0); pair B = (9,0);
		draw(A--B, Arrows);
		label("$\mathcal V( (x-4)(x-9) )$", (0,0), 2*dir(-90));
		dot("$4$", (-1,0), dir(90));
		dot("$9$", (3,0), dir(90));
		label("$\mathbb A^1$", A+(2,0), dir(90));
	\end{asy}
\end{center}

In general, in $\Aff^1$ you can get finitely many points $\left\{ a_1, \dots, a_n \right\}$ by
just taking \[ \VV\left( (x-a_1)(x-a_2)\dots(x-a_n) \right). \]
On the other hand, you can't get the set $\{0,1,2,\dots\}$ as an affine variety; the only polynomial vanishing
on all those points is the zero polynomial.
In fact, you can convince yourself that these are the only affine varieties, with two exceptions:
\begin{itemize}
	\ii The entire line $\Aff^1$ is given by $\VV(0)$, and
	\ii The empty set is given by $\VV(1)$.
\end{itemize}
\begin{ques}
	Show that these are the only varieties of $\Aff^1$.
	(Let $\VV(I)$ be the variety and pick a $0 \neq f \in I$.)
\end{ques}

As you might correctly guess, we have the following result.
\begin{theorem}[Intersections and Unions of Varieties]
	\listhack
	\begin{enumerate}[(a)]
		\ii The intersection of several affine varieties (even infinitely many) is an affine variety.
		\ii The union of two affine varieties (and by induction finitely many) is an affine variety.
	\end{enumerate}
\end{theorem}
\begin{exercise}
	Prove this yourself.
\end{exercise}

Now note that most of the affine varieties of $\Aff^1$, like $\{4,9\}$,
are just unions of the simplest ``one-point'' ideals.
To ease our classification,
we can restrict our attention to the case of \emph{irreducible} varieties;
\begin{definition}
	A variety $V$ is \vocab{irreducible} if it cannot be written
	as the nontrivial union of two varieties $V = V_1 \cup V_2$.
	(Here nontrivial means that $V_1, V_2 \subsetneq V$.)
\end{definition}

Hence, the irreducible varieties of $\Aff^1$ are
\begin{enumerate}[(i)]
	\ii The empty set,
	\ii a single point, and
	\ii the entire line $\Aff^1$.
\end{enumerate}

In a moment, we'll draw pictures in $\Aff^2$,
but first let me point out something about irreducible affine varieties.

\section{Prime Ideals Correspond To Irreducible Affine Varieties}
\prototype{$(xy)$ corresponds to the union of two lines in $\Aff^2$.}
We have seen that the semiprime ideals are in one-to-one correspondence with affine varieties.
In the next sections we answer the two questions:
\begin{itemize}
	\ii What property of $\VV(I)$ corresponds to $I$ being prime?
	\ii What property of $\VV(I)$ corresponds to $I$ being maximal?
\end{itemize}
The first question is easier to answer.
Let's take a standard non-prime ideal in $\CC[x,y]$, such as $I = (xy)$.
Its vanishing set $\VV(I)$ is the union of two lines $x=0$ and $y=0$.
So $\VV(I)$ is reducible.

Let's make this work in general.
\begin{theorem}[Prime $\iff$ Irreducible]
	Let $I$ be a semiprime ideal, and $V = \VV(I)$ a nonempty variety.
	Then $I$ is prime if and only if $V$ is irreducible.
\end{theorem}
\begin{proof}
	First, assume $V$ is irreducible; we'll show $I$ is prime.
	Let $f,g \in \CC[x_1, \dots, x_n]$ so that $fg \in I$.
	Then $V$ is a subset of the union $\VV(f) \cup \VV(g)$;
	actually, $V = \left( V \cap \VV(f) \right) \cup \left( V \cap \VV(g) \right)$.
	Since $V$ is irreducible, we may assume $V = V \cap \VV(f)$,
	hence $f$ vanishes on all of $V$. So $f \in I$.

	The reverse direction is similar.
\end{proof}

\begin{remark}
	The above proof illustrates the following principle.
	Let $V$ be an irreducible variety.
	Suppose that $V \subseteq V_1 \cup V_2$;
	this implies $V = (V_1 \cap V) \cup (V_2 \cap V)$.
	Recall that the intersection of two varieties is a variety.
	Thus an irreducible variety can't even be \emph{contained}
	in a nontrivial union of two varieties.
\end{remark}

\section{Pictures in $\Aff^2$ and $\Aff^3$}
\prototype{Various curves and hypersurfaces.}
Next, we turn our attention to the ``complex affine plane'', $\Aff^2$.
What are the irreducible affine varieties in it?

As we saw in the previous discussion, naming irreducible affine varieties in $\Aff^2$
amounts to naming the prime ideals of $\CC[x,y]$.
Here are a few.
\begin{enumerate}[(i)]
	\ii $(0)$ is prime. $\VV(0)$ as usual corresponds to the entire plane.
	\ii $(x-a, y-b)$ is a prime ideal, since $\CC[x,y] / (x-a, y-b) \cong \CC$ is an integral domain.
	(In fact, since $\CC$ is a field, the ideal $(x-a,y-b)$ is \emph{maximal}).
	The vanishing set of this is $\VV(x-a, y-b) = \{ (a,b) \} \in \CC^2$,
	so these ideals correspond to a single point.
	\ii Let $f(x,y)$ be an irreducible polynomial, like $y-x^2$.
	Then $(f)$ is a prime ideal! Here $\VV(I)$ is a ``degree one curve''.
\end{enumerate}

By using some polynomial algebra (again you're welcome to check this; Euclidean algorithm),
these are in fact the only prime ideals of $\CC[x,y]$.
Here's a picture.

\begin{center}
	\begin{asy}
		import graph;
		graph.xaxis("$x$", -4, 4);
		graph.yaxis("$y$", -4, 4);

		real f (real x) { return x*x; }
		draw(graph(f,-2,2,operator ..));
		label("$\mathcal V(y-x^2)$", (1,1), dir(-45));
		dot("$\mathcal V(x-1,y+2)$", (1,-2), dir(-45));
	\end{asy}
\end{center}


As usual, you can make varieties which are just unions of these irreducible ones.
For example, if you wanted the variety consisting of a parabola $y=x^2$
plus the point $(20,15)$ you would write
\[ \VV \left( (y-x^2)(x-20), (y-x^2)(y-15) \right). \]

The picture in $\Aff^3$ is harder to describe.
Again, you have points $\VV(x-a, y-b, z-c)$ corresponding to 
he zero-dimensional points $(a,b,c)$, and two-dimensional surfaces
$\VV(f)$ for each irreducible polynomial $f$ (for example, $x+y+z=0$ is a plane).
But there are more prime ideals, like $\VV(x,y)$, which corresponds to the
intersection of the planes $x=0$ and $y=0$: this is the one-dimensional $z$-axis.
It turns out there is no reasonable way to classify the ``one-dimensional'' varieties;
they correspond to ``irreducible curves''.

Thus, as Ravi Vakil \cite{ref:vakil} says,
\begin{moral}
	The purely algebraic question of determining the prime ideals of $\CC[x,y,z]$
	has a fundamentally geometric answer.
\end{moral}

\section{Maximal Ideals}
\prototype{All maximal ideals are $(x-a_1, \dots, x-a_n)$.}
\begin{ques}
	Show that if $I \subseteq J$ then $\VV(I) \supseteq \VV(J)$.
	Thus $\VV(-)$ is \emph{inclusion-reversing}.
\end{ques}
Thus, bigger ideals correspond to smaller varieties.
As the above pictures might have indicated, the smallest varieties are \emph{single points}.
Moreover, as you might guess from the name, the biggest ideals are the \emph{maximal ideals},
which by the Nullstellentsatz are all of the form
\[ \left( x_1-a_1, \dots, x_n-a_n \right). \]
Certainly, all such ideals are indeed maximal since
\[ \CC[x_1, \dots, x_n] / \left( x-a_1, \dots, x-a_n \right) \cong \CC \]
is a field.
The question is: are all maximal ideals of this form?

The answer is in the affirmative. It's equivalent to the following result.
\begin{theorem}
	[Weak Nullestellensatz]
	Let $I \subsetneq \CC[x_1, \dots, x_n]$ be a proper ideal.
	Then the variety $\VV(I) \neq \varnothing$.
\end{theorem}
The proof of this is surprisingly pernicious, so
we won't include it here \todo{but link it somewhere}.

From this we can deduce that all maximal ideals are of the above form.
\begin{theorem}
	[Maximal Ideals]
	Every maximal ideal of $\CC[x_1, \dots, x_n]$
	is of the form $\VV(x_1-a_1, \dots, x_n-a_n)$.
\end{theorem}
\begin{proof}
	[WN implies MI]
	Let $J$ be a maximal ideal, and consider the corresponding variety $V = \VV(J)$.
	By WN, it contains some point $p=(a_1, \dots, a_n)$.
	Now, define $I = (x-a_1, \dots, x-a_n)$; this ideal contains all polynomials
	vanishing at $p$, so necessarily $J \subseteq I \subsetneq \CC[x_1, \dots, x_n]$.
	Then by maximality of $J$ we have $J=I$.
\end{proof}
Again this uses the fact that $\CC$ is algebraically closed. Thus:
\begin{moral}
	Over $\CC$, maximal ideals correspond to single points.
\end{moral}

Consequently, our various ideals over $\CC$ correspond to various flavors
of affine varieties according to the following table:

\begin{center}
	\begin{tabular}[h]{|cc|}
		\hline
		Algebraic Flavor & Geometric Flavor \\ \hline
		semiprime ideal & affine variety \\
		prime ideal & irreducible variety \\
		maximal ideal & single point \\
		any ideal & scheme \\ \hline
	\end{tabular}
\end{center}

There's one thing I haven't talked about: what's the last entry?

\section{Why Schemes?}
One of the most elementary motivations for the scheme
is that we would like to use them to count multiplicity.
That is, consider the intersection
\[ \VV(y-x^2) \cap \VV(y) \subseteq \Aff^2 \] 
This is the intersection of the parabola with the tangent $x$-axis,
this is the green dot below.

\begin{center}
	\begin{asy}
		import graph;
		size(5cm);

		real f(real x) { return x*x; }
		graph.xaxis("$x$", red);
		graph.yaxis("$y$");
		draw(graph(f,-2,2,operator ..), blue, Arrows);
		label("$\mathcal V(y-x^2)$", (0.8, f(0.8)), dir(-45), blue);
		label("$\mathbb A^2$", (2,3), dir(45));
		dotfactor *= 1.5;
		dot(origin, heavygreen);
	\end{asy}
\end{center}

Unfortunately, as a variety, it is just a single point!
However, we want to think of this as a ``double point'':
after all, in the obvious sense it has multiplicity $2$.
You can detect this when you look at the ideals:
\[ (y-x^2) + (y) = (x^2,y) \]
and thus, if we blithely ignore taking the radical, we get
\[ \CC[x,y] / (x^2,y) \cong \CC[\eps] / (\eps^2). \]
So the ideals in question are noticing the presence of a double point.

In order to encapsulate this, we need a more refined object than
a variety, which (at the end of the day) is really a bunch of points.
This refined object is the \emph{scheme}.

\section\problemhead

\begin{problem}
	Show that a \emph{real} affine variety $V \subseteq \Aff_\RR^n$
	can always be written in the form $\VV(f)$.
	\begin{hint}
		Squares.
	\end{hint}
	\begin{sol}
		If $V = \VV(I)$ with $I = (f_1, \dots, f_m)$
		(as usual there are finitely many polynomials since $\RR[x_1, \dots, x_n]$ is Noetherian)
		then we can take $f = f_1^2 + \dots + f_m^2$.
	\end{sol}
\end{problem}

\begin{problem}
	\kurumi
	Show that Hilbert's Nullstellensatz in $n$ dimensions
	follows from the Weak Nullstellensatz.
	(This solution is called the \vocab{Rabinowitsch Trick}.)
	\begin{hint}
		Use the weak nullstellensatz on $n+1$ dimensions.
		Given $f$ vanishing on everything,
		consider $x_{n+1}f-1$. 
	\end{hint}
	\begin{sol}
		The point is is to check that if $f$ vanishes on all of $\VV(I)$,
		then $f \in \sqrt I$.

		Take a set of generators $f_1, \dots, f_m$,
		in the original ring $\CC[x_1, \dots, x_n]$;
		we may assume it's finite by the Hilbert Basis Theorem.

		We're going to do a trick now:
		consider $S = \CC[x_1, \dots, x_n, x_{n+1}]$ instead.
		Consider the ideal $I' \subseteq S$ in the bigger ring
		generated by $\{f_1, \dots, f_m\}$ and the polynomial $x_{n+1} f - 1$.
		The point of the last guy is that its zero locus
		does not touch our copy $x_{n+1}=0$ of $\Aff^n$
		nor any point in the ``projection'' of $f$ through $\Aff^{n+1}$
		(one can think of this as $\VV(I)$ in the smaller ring
		direct multiplied with $\CC$).
		Thus $\VV(I') = \varnothing$, and by the weak nullstellensatz
		we in fact have $I' = \CC[x_1, \dots, x_{n+1}]$.
		So
		\[ 1 = g_1f_1 + \dots + g_mf_m + g_{m+1} \left( x_{n+1}f-1 \right). \]
		Now the hack: \textbf{replace every instance of $x_{n+1}$ by $\frac 1f$},
		and then clear all denominators.
		Thus for some large enough integer $N$ we can get
		\[ f^N = f^N(g_1f_1 + \dots + g_mf_m) \]
		which eliminates any fractional powers of $f$ in the right-hand side.
		It follows that $f^N \in I$.
	\end{sol}
\end{problem}


\chapter{Affine Varieties as Ringed Spaces}
As in the previous chapter, we are working only over affine varieties in $\CC$ for simplicity.

\section{Synopsis}
Group theory was a strange creature in the early 19th century.
During the 19th century, a group was literally defined
as a subset of $\GL(n)$ or of $S_n$.
Indeed, the word ``group'' hadn't been invented yet.
This may sound ludicrous, but it was true -- Sylow developed his theorems without this notion.
Only much later did the abstract definition of a group was given,
an abstract set $G$ which was independent of any \emph{embedding} into $S_n$,
and an object in its own right.

We are about to make the same type of change for our affine varieties.
Rather than thinking of them as an object locked into an ambient space $\Aff^n$
we are instead going to try to make them into an object in their own right.
Specifically, for us an affine variety will become a \emph{topological space}
equipped with a \emph{ring of functions} for each of its open sets:
this is why we call it a \vocab{ringed space}.

The bit about the topological space is not too drastic.
The key insight is the addition of the ring of functions.
For example, consider the double point from last chapter.

\begin{center}
	\begin{asy}
		import graph;
		size(5cm);

		real f(real x) { return x*x; }
		graph.xaxis("$x$", red);
		graph.yaxis("$y$");
		draw(graph(f,-2,2,operator ..), blue, Arrows);
		label("$\mathcal V(y-x^2)$", (0.8, f(0.8)), dir(-45), blue);
		label("$\mathbb A^2$", (2,3), dir(45));
		dotfactor *= 1.5;
		dot(origin, heavygreen);
	\end{asy}
\end{center}

As a set, it is a single point,
and thus it can have only one possible topology.
But the addition of the function ring will let us tell it apart
from just a single point.

This construction is quite involved, so we'll proceed as follows:
we'll define the structure bit by bit onto our existing affine varieties in $\Aff^n$,
until we have all the data of a ringed space.
In later chapters, these ideas will grow up to
become the core of modern algebraic geometry: the \emph{scheme}.

\section{The Zariski Topology on $\Aff^n$}
\prototype{In $\Aff^1$, closed sets are finite collections of points.
In $\Aff^2$, a nonempty open set is the whole space minus some finite collection of curves/points.}

We begin by endowing a topological structure on every variety $V$.
Since our affine varieties (for now) all live in $\Aff^n$, all we have to do
is put a suitable topology on $\Aff^n$, and then just view $V$ as a subspace.

However, rather than putting the standard Euclidean topology on $\Aff^n$,
we put a much more bizarre topology.
\begin{definition}
	In the \vocab{Zariski topology} on $\Aff^n$,
	the \emph{closed sets} are those of the form 
	\[ \VV(I) \qquad\text{where}\quad I \subset \CC[x_1, \dots, x_n]. \]
	Of course, the open sets are complements of such sets.
\end{definition}

\begin{example}
	[Zariski Topology on $\Aff^1$]
	Let us determine the open sets of $\Aff^1$,
	which as usual we picture as a straight line
	(ignoring the fact that $\CC$ is two-dimensional).

	Since $\CC[x]$ is a principal ideal domain, rather than looking at $\VV(I)$
	for every $I \subseteq \CC[x]$, we just have to look at $\VV(f)$ for a single $f$.
	There are a few flavors of polynomials $f$:
	\begin{itemize}
		\ii The zero polynomial $0$ which vanishes everywhere:
		this implies that the entire space $\Aff^1$ is a closed set.
		\ii The constant polynomial $1$ which vanishes nowhere.
		This implies that $\varnothing$ is a closed set.
		\ii A polynomial $c(x-t_1)(x-t_2)\dots(x-t_n)$ of degree $n$.
		It has $n$ roots, and so $\{t_1, \dots, t_n\}$ is a closed set.
	\end{itemize}
	Hence the closed sets of $\Aff^1$ are exactly all of $\Aff^1$
	and finite sets of points (including $\varnothing$).
	Consequently, the \emph{open} sets of $\Aff^1$ are
	\begin{itemize}
		\ii $\varnothing$, and
		\ii $\Aff^1$ minus a finite collection (possibly empty) of points.
	\end{itemize}
\end{example}

Thus, the picture of a ``typical'' open set $\Aff^1$ might be 
\begin{center}
	\begin{asy}
		size(6cm);
		pair A = (-9,0); pair B = (9,0);
		pen bloo = blue+1.5;
		draw(A--B, blue, Arrows);
		draw(A--B, bloo);
		// label("$\mathbb V()$", (0,0), 2*dir(-90));
		opendot((-3,0), bloo);
		opendot((-1,0), bloo);
		opendot((4,0), bloo);
		label("$\mathbb A^1$", B-(2,0), dir(90));
	\end{asy}
\end{center}
It's everything except a few marked points!

\begin{example}[Zariski Topology on $\Aff^2$]
	Similarly, in $\Aff^2$, the interesting closed sets are going to consist of finite unions
	(possibly empty) of the following:
	\begin{itemize}
		\ii Closed curves, like $\VV(y-x^2)$ (which is a parabola).
		\ii Single points, like $\VV(x-3,y-4)$ (which is the point $(3,4)$).
	\end{itemize}
	Of course, the entire space $\Aff^2 = \VV(0)$ and the empty set $\varnothing = \VV(1)$
	are closed sets.

	Thus the nonempty open sets in $\Aff^2$ consist of the \emph{entire} plane,
	minus a finite collection of points and one-dimensional curves.
\end{example}
\begin{ques}
	Draw a picture (to the best of your artistic ability) of a ``typical''
	open set in $\Aff^2$.
\end{ques}

All this is to say
\begin{moral}
	The nonempty Zariski open sets are \emph{huge}.
\end{moral}
This is an important difference than what you're used to in topology.
To be very clear:
\begin{itemize}
	\ii In the past, if I said something like ``has so-and-so property in a neighborhood of point $p$'',
	one thought of this as saying ``is true in a small region around $p$''.
	\ii In the Zariski topology, ``has so-and-so property in a neighborhood of point $p$'' should be thought
	of as saying ``is true for virtually all points, other than those on certain curves''.
\end{itemize}
Indeed, ``neighborhood'' is no longer a very accurate description.

It remains to verify that as I've stated it, the closed sets actually form a topology.
That is, I need to verify briefly that
\begin{itemize}
	\ii $\varnothing$ and $\Aff^n$ are both closed.
	\ii Intersections of closed sets (even infinite) are still closed.
	\ii Finite unions of closed sets are still closed.
\end{itemize}
Well, closed sets are the same as varieties, so we already know this!

\section{The Zariski Topology on Affine Varieties}
\prototype{If $V = \VV(y-x^2)$ is a parabola, then $V$ minus $(1,1)$ is open in $V$.
Also, the plane minus the origin is $D(x) \cup D(y)$.}

As we said before, by considering a variety $V$ as a subspace of $\Aff^n$
it inherits the Zariski topology.
One should think of an open subset of $V$ as ``$V$ minus a few Zariski-closed sets''.
For example:
\begin{example}[Open Set of a Variety]
	Let $V = \VV(y-x^2) \subseteq \Aff^2$ be a parabola,
	and let $U = V \setminus \{(1,1)\}$. We claim $U$ is open in $V$.
	\begin{center}
		\begin{asy}
		import graph;
		size(5cm);

		real f(real x) { return x*x; }
		graph.xaxis("$x$");
		graph.yaxis("$y$");
		draw(graph(f,-2,2,operator ..), blue, Arrows);
		label("$\mathcal V(y-x^2)$", (0.8, f(0.8)), dir(-45));

		opendot( (1,1), blue+1);
		\end{asy}
	\end{center}
	Indeed, $\tilde U = \Aff^2 \setminus \{(1,1)\}$ is open in $\Aff^2$
	(since it is the complement of the closed set $\VV(x-1,y-1)$),
	so $U = \tilde U \cap V$ is open in $V$.
	Note that on the other hand the set $U$ is \emph{not} open in $\Aff^2$.
\end{example}

We'll finish by giving a nice basis of the Zariski topology.
\begin{definition}
	Given $V \subseteq \Aff^n$ an affine variety and $f \in \CC[x_1, \dots, x_n]$,
	we define the \vocab{distinguished open set} $D(f)$ to be the open set in $V$
	of points not vanishing on $f$:
	\[ D(f) = \left\{ p \in V \mid f(p) \neq 0 \right\} = V \setminus \VV(f). \]
\end{definition}
\cite{ref:vakil} suggests remembering the notation $D(f)$ as ``doesn't-vanish set''.
\begin{example}
	[Examples of (Unions of) Distinguished Open Sets]
	\listhack
	\begin{enumerate}[(a)]
		\ii If $V = \Aff^1$ then $D(x)$ corresponds to a line minus a point.
		\ii If $V = \VV(y-x^2) \subseteq \Aff^2$,
		then $D(x)$ corresponds to the parabola minus $(1,1)$.
		\ii If $V = \Aff^2$, then $D(x) \cup D(y) = \Aff^2 \setminus \{ (0,0) \}$ is the punctured plane.
	\end{enumerate}
\end{example}
\begin{ques}
	Show that every open set of a $V \subset \Aff^n$
	can be written as a finite union of distinguished open sets.
\end{ques}
\begin{exercise}
	Give an example of an open set of $\Aff^2$ which is not a distinguished open set.
\end{exercise}

\section{Coordinate Rings}
\prototype{If $V = \VV(y-x^2)$ then $\CC[V] = \CC[x,y]/(y-x^2)$.}

The next thing we do is consider the functions from $V$ to the base field $\CC$.
We restrict our attention to algebraic (polynomial) functions on a variety $V$:
they should take every point $(a_1, \dots, a_n)$ on $V$ to some complex number $P(a_1, \dots, a_n) \in \CC$.
For example, a valid function on a three-dimensional affine variety might be $(a,b,c) \mapsto a$;
we just call this projection ``$x$''.
Similarly we have a canonical projection $y$ and $z$,
and we can create polynomials by combining them,
say $x^2y + 2xyz$.

\begin{definition}
	The \vocab{coordinate ring} $\CC[V]$ of a variety $V$
	is the ring of polynomial functions on $V$.
	(Notation explained next section.)
\end{definition}

At first glance, we might think this is just $\CC[x_1, \dots, x_n]$.
But on closer inspection we realize that \emph{on a given variety},
some of these functions are the same.
For example, consider in $\Aff^2$ the parabola $V = \VV(y-x^2)$.
Then the two functions
\begin{align*}
	V & \to \CC \\
	(x,y) & \mapsto x^2 \\
	(x,y) & \mapsto y
\end{align*}
are actually the same function!
We have to ``mod out'' by the ideal $I$ which generates $V$.
This leads us naturally to the following:
\begin{theorem}[Coordinate Rings Correspond to Ideal]
	Let $I$ be a semiprime ideal, and $V = \VV(I) \subseteq \Aff^n$.
	Then \[ \CC[V] \cong \CC[x_1, \dots, x_n] / I.  \]
\end{theorem}
\begin{proof}
	There's a natural surjection as above
	\[ \CC[x_1, \dots, x_n] \surjto \CC[V] \]
	and the kernel is $I$.
\end{proof}
Thus properties of a variety $V$ correspond to properties of the ring $\CC[V]$.

\section{The Sheaf of Regular Functions}
\prototype{Let $V = \Aff^1$, $U = V \setminus \{0\}$. Then $1/x \in \OO_V(U)$ is regular on $U$.}

Let $V$ be an affine variety and let $\CC[V]$ be its coordinate ring.
We want to define a notion of $\OO_V(U)$ for any open set $U$:
the ``nice'' functions on any open subset.
Obviously, any function is the $\CC[V]$ will work as a function on $\OO_V(U)$.
However, to capture more of the structure we want to
loosen our definition slightly of ``nice'' function slightly
by allowing \emph{rational} functions.

The chief example is that $1/x$ should be a regular function
on $\Aff^1 \setminus \{0\}$.
The first natural guess is:
\begin{definition}
	Let $U \subseteq V$ be an open set of the variety $V$.
	A \vocab{rational function} on $U$
	is a quotient $f(x) / g(x)$ of two elements $f$ and $g$ in $\CC[V]$,
	where we require that $g(x) \neq 0$ for $x \in U$.
\end{definition}
However, the definition is slightly too restrictive;
we have to allow for multiple representations in the following way.
\begin{definition}
	Let $U \subseteq V$ be open.
	We say a function $\phi : U \to \CC$ is a \vocab{regular function} if
	for every point $p$, we can find an open set $U_p$ containing $p$
	and a rational function $f_p/g_p$ on $U_p$ such that
	\[ \phi(x) = \frac{f_p(x)}{g_p(x)} \qquad \forall x \in U_p. \]
	In particular, we require $g_p(x) \neq 0$ on the set $U_p$.
	We denote the set of all regular functions on $U$ by $\OO_V(U)$.
\end{definition}

Thus,
\begin{moral}
	$\phi$ is regular on $U$ if it is locally a rational function.
\end{moral}

This definition is misleadingly complicated,
and the examples should illuminate it significantly.
Firstly, in practice, most of the time we will be able to find
a ``global'' representation of a regular function as a quotient,
and we will not need to fuss with the $p$'s.
For example:
\begin{example}
	[Regular Functions]
	\listhack
	\begin{enumerate}[(a)]
		\ii Any function in $f \in \CC[V]$ is clearly regular,
		since we can take $g_p = 1$, $f_p = f$ for every $p$.
		So $R \subseteq \OO_V(U)$ for any open set $U$.
		\ii Let $V = \Aff^1$, $U_0 = V \setminus \{0\}$.
		Then $1/x \in \OO_V(U_0)$ is regular on $U$.
		\ii Let $V = \Aff^1$, $U_{12} = V \setminus \{1,2\}$. Then 
		\[ \frac{1}{(x-1)(x-2)} \in \OO_V(U_{12}) \]
		is regular on $U$.
	\end{enumerate}
\end{example}
The ``local'' clause with $p$'s is still necessary, though.
\begin{example}
	[Requiring Local Representations]
	\label{ex:local_rep}
	Consider the variety
	\[ V = \VV(ab-cd) \subseteq \Aff^4 \]
	and the open set $U = V \setminus \VV(b,d)$.
	There is a regular function on $U$ given by
	\[
		(a,b,c,d)
		\mapsto
		\begin{cases}
			a/d & d \neq 0 \\
			c/b & b \neq 0.
		\end{cases}
	\]
	Clearly these are the ``same function'' (since $ab=cd$),
	but we cannot write ``$a/d$'' or ``$c/b$''
	to express it because we run into divide-by-zero issues.
	That's why in the definition of a regular function,
	we have to allow multiple representations.
\end{example}

In fact, we will see later on that the definition
of a regular function is a special case of a more
general construction called \emph{sheafification},
in which ``sheaves of functions which are $P$'' are transformed
into ``sheaves of functions which are \emph{locally} $P$''.

\section{Regular Functions on Distinguished Open Sets}
\prototype{Regular functions on $\Aff^1 \setminus \{0\}$ are $P(x) / x^n$.}
The division-by-zero, as one would expect,
essentially prohibits regular functions on the entire space $V$;
i.e.\ there are no regular functions in $\OO_V(V)$
that were not already in $\CC[V]$.
Actually, we have the following more general result which computes the
regular functions on distinguished open sets.

\begin{theorem}
	[Regular Functions on Distinguished Open Sets]
	\label{thm:reg_func_distinguish_open}
	Let $V \subset \Aff^n$ be an affine variety
	and $D(g)$ a distinguished open subset of it.
	Then
	\[
		\OO_V( D(g) )
		=
		\left\{ \frac{f}{g^n} \mid f \in \CC[V] \text{ and } n \in \ZZ \right\}.
	\]
	In particular, $\OO_V(V) = \OO_V(D(1)) \cong \CC[V]$.
\end{theorem}
The proof of this theorem requires the Nullstellensatz,
so it relies on $\CC$ being algebraically closed.
In fact, a counter-example is easy to find if we replace $\CC$ by $\RR$:
consider $\frac{1}{x^2+1}$.
\begin{proof}
	Obviously, every function of the form $f/g^n$ works,
	so we want the reverse direction.
	% This is long, and perhaps should be omitted on a first reading.

	Here's the situation.
	Let $U = D(g)$.
	We're given a regular function $\phi$, meaning at every point $p \in D(g)$,
	there is a neighborhood $U_p$ on which $\phi$ can be expressed
	as $f_p / g_p$ (where $f_p, g_p \in \CC[V]$).
	Then, we want to construct an $f \in \CC[V]$ and an integer $n$
	such that $\phi = f/g^n$.

	First, look at a particular $U_p$ and $f_p / g_p$.
	Shrink $U_p$ to a distinguished open set $D(h_p)$.
	Then, let $\wt f_p = f_p h_p$ and $\wt g_p = g_p h_p$.
	Thus we have that
	\[ \frac{\wt f_p}{\wt g_p} \text{ is correct on }
		D(h_p) \subseteq U \subseteq X. \]
	The upshot of using the modified $f_p$ and $g_p$ is that:
	\[ \wt f_p \wt g_q = \wt f_q \wt g_p \qquad \forall p,q \in U. \]
	Indeed, it is correct on $D(h_p) \cap D(h_q)$ by definition,
	and outside this set both the left-hand side and right-hand side are zero.

	Now, we know that $D(g) = \bigcup_{p \in U} D(\wt g_p)$, i.e.\
	\[ \VV(g) = \bigcap_{p \in U} \VV(\wt g_p). \]
	So by the Nullstellensatz we know that
	\[ g \in \sqrt{(\wt g_p : p \in U)}
		\implies \exists n : g^n \in (\wt g_p : p \in U). \]
	In other words, for some $n$ and $k_p \in \CC[V]$ we have
	\[ g^n = \sum_p k_p \wt g_p \]
	where only finitely many $k_p$ are not zero.
	Now, we claim that
	\[ f \defeq \sum_p k_p \wt f_p \]
	works.
	This just observes by noting that for any $q \in U$, we have
	\[
		f \wt g_q - g^n \wt f_q
		= \sum_p k_p(\wt f_p \wt g_q - \wt g_p \wt f_q)
		= 0. \qedhere
	\]
\end{proof}
This means that the \emph{global} regular functions
are just the same as those in the coordinate ring:
you don't gain anything new by allowing it to be locally a quotient.
(The same goes for distinguished open sets.)

\begin{example}[Regular Functions on Distinguished Open Sets]
	\listhack
	\begin{enumerate}[(a)]
		\ii Taking $g=1$ we recover $\OO_V(V) \cong \CC[V]$ for any affine variety $V$.
		\ii Let $V = \Aff^1$, $U_0 = V \setminus \{0\}$. Then
		\[ \OO_V(U_0)
			= \left\{ \frac{P(x)}{x^n} \mid P \in \CC[x], \quad n \in \ZZ \right\}. \]
		So more examples are $1/x$ and $(x+1)/x^3$.
	\end{enumerate}
\end{example}

\begin{ques}
	Why doesn't our theorem on regular functions apply to \Cref{ex:local_rep}?
\end{ques}

The regular functions will become of crucial importance
once we begin defining a scheme in the next chapter.

\section{Baby's Ringed Spaces}
In summary, given an affine variety $V$ we have
added the following structure to it:
\begin{itemize}
	\ii It has a structure of a set of points,
	\ii It has a structure of a topological space $V$ on these points, and
	\ii For every open set $U \subseteq V$
	we have associated a ring $\OO_V(U)$ to it.
	Elements of the rings are functions $U \to \CC$.
\end{itemize}
Let us agree that:
\begin{definition}
	A \vocab{baby's ringed space} is a topological space $X$
	equipped with a ring $\OO_X(U)$ for every open set $U$.
	It is required that elements of the ring $\OO_X(U)$
	are functions $f : U \to \CC$;
	we call these the \emph{regular functions} of $X$ on $U$.
\end{definition}
Therefore, affine varieties are baby's ringed spaces.
\begin{remark}
	This is not a standard definition. Hehe.
\end{remark}

The reason this is called a ``baby's ringed space''
is that in a \emph{ringed space},
the rings $\OO_V(U)$ can actually be \emph{any rings},
but they have to satisfy a set of fairly technical conditions.
When this happens, it's the $\OO_V$ that does all the work;
we think of $\OO_V$ as a type of functor called a \emph{sheaf}.

Since we are only studying affine/projective/quasi-projective varieties
for the next chapters, we will just refer to these as baby's ringed spaces
so that we don't have to deal with the entire definition.
The key concept is that we want to think of these varieties
as \emph{intrinsic objects}, free of any embedding.
A baby's ringed space is philosophically the correct thing to do.

Anyways, affine varieties are baby's ringed spaces $(V, \OO_V)$.
In the next chapter we'll meet projective and quasi-projective
varieties, which give more such examples of (baby's) ringed spaces.
With these examples in mind, we will finally lay down
the complete definition of a ringed space,
and use this to define a scheme.

\section\problemhead
\begin{problem}
	Show that an affine variety $V$ is always compact (in the Zariski topology).
\end{problem}

\begin{dproblem}
	Show that for any $n \ge 1$ the Zariski topology of $\Aff^n$
	is \emph{not} Hausdorff.
\end{dproblem}

\begin{sproblem}
	Let $V = \Aff^2$ and let $U = \Aff^2 \setminus \{(0,0)\}$ be the punctured plane.
	Compute $\OO_V(U)$.
\end{sproblem}
\chapter{Projective Varieties}
Having studied affine varieties in $\Aff^n$, we now consider $\CP^n$.
We will also make it into a baby's ringed space
in the same way as with $\Aff^n$.

\section{Graded Rings}
\prototype{$\CC[x_0, \dots, x_n]$ is a graded ring.}
We first take the time to state what a graded ring is,
just so that we have this language to use (now and later).

\begin{definition}
	A \vocab{graded ring} $R$ is a ring with the following additional structure:
	as an abelian group, it decomposes as
	\[ R = \bigoplus_{d \ge 0} R^d \]
	where $R^0$, $R^1$, \dots, are abelian groups.
	The ring multiplication is required to satisfy the following property:
	if $r \in R^d$ and $s \in R^e$, we have $rs \in R^{d+e}$.
	Elements of an $R^d$ are called \vocab{homogeneous elements}.

	We denote by $R^+$ the ideal $R \setminus R_0$ generated by
	the homogeneous elements of nonzero degree,
	and call it the \vocab{irrelevant ideal}.
\end{definition}
\begin{remark}
	For algebraic geometry,
	our graded rings will always have unit and be commutative.
\end{remark}
\begin{example}
	[Examples of Graded Rings]
	\listhack
	\begin{enumerate}[(a)]
		\ii The ring $\CC[x]$ is graded by degree.
		\ii More generally, the polynomial ring $\CC[x_0, \dots, x_n]$
		is graded by degree.
	\end{enumerate}
\end{example}

We will frequently refer to homogeneous ideals:
\begin{definition}
	An ideal $I \subseteq \CC[x_0, \dots, x_n]$ is \vocab{homogeneous}
	if it can be written as $I = (f_1, \dots, f_m)$
	where each $f_i$ is a homogeneous polynomial.
\end{definition}
\begin{remark}
	If $I$ and $J$ are homogeneous,
	then $I+J$, $I \cap J$, $\sqrt I$ are homogeneous too.
\end{remark}
\begin{lemma}[Graded Quotients are Graded Too]
	Let $I$ be a homogeneous ideal of a graded ring $R$.
	Then
	\[ R/I = \bigoplus_{d \ge 0} R_d / (R_d \cap I) \]
	realizes $R/I$ as a graded ring.
\end{lemma}
Since these assertions are just algebra,
we omit their proofs here.
\begin{example}
	[Example of a Graded Quotient Ring]
	Let $R = \CC[x,y]$ and set $I = (x^3, y^2)$. Then
	\begin{align*}
		R^0 &= \CC \\
		R^1 &= \CC x \oplus \CC y \\
		R^2 &= \CC x^2 \oplus \CC xy \\
		R^3 &= \CC x^2y \\
		R^d &= 0 \qquad \forall d \ge 4.
	\end{align*}
	So in fact $R/I$ is graded, and is a six-dimensional $\CC$-vector space.
\end{example}


\section{The Ambient Space}
\prototype{Perhaps $\VV(x^2+y^2-z^2)$ work.}
The set of points we choose to work with is $\CP^n$ this time,
which for us can be thought of as the set of $n$-tuples
\[ \left( x_0 : x_1 : \dots : x_n \right) \]
not all zero, up to scaling.
Equivalently, it is the set of lines through the origin in $\CC^{n+1}$.
Projective space is defined in full in \Cref{sec:top_spaces},
and you should refer there if you aren't familiar with projective space.

The right way to think about it is ``$\Aff^n$ plus points at infinity'':
\begin{definition}
	We define the set
	\[ U_i = \left\{ (x_0 : \dots : x_n) \mid x_i \neq 0  \right\}
		\subseteq \CP^n. \]
	These are called the \vocab{standard affine charts}.
\end{definition}
The name comes from the following:
\begin{exercise}
	(Mandatory)
	Give a natural bijection from $U_i$ to $\Aff^n$.
	Thus we can think of $\CP^n$ as the affine set $U_i$
	plus ``points at infinity''.
\end{exercise}
\begin{remark}
	In fact, these charts $U_i$ make $\CP^n$ with its usual topology
	into a complex manifold with holomorphic transition functions.
\end{remark}

However, like before we want to impose a Zariski topology on it.
For concreteness, let's consider $\CP^2 = \left\{ (x_0 : x_1 : x_2) \right\}$.
We wish to consider zero loci in $\CP^2$, just like we did in affine space,
and hence obtain a notion of a projective variety.

But this isn't so easy: for example,
the function ``$x_0$'' is not a well-defined function on points in $\CP^2$ 
because $(x_0 : x_1 : x_2) = (5x_0 : 5x_1 : 5x_2)$!
So we'd love to consider these ``pseudo-functions''
that still have zero loci. These are just the homogeneous polynomials $f$,
because $f$ is homogeneous of degree $d$ if and only if
\[
	f(\lambda x_0, \dots, \lambda x_n)
	= \lambda^d f(x_0, \dots, x_n).
\]
In particular, the relation ``$f(x_0, \dots, x_n) = 0$'' is
well-defined if $F$ is homogeneous. Thus, we can say:
\begin{definition}
	If $f$ is homogeneous, we can then define its \vocab{vanishing locus} as
	\[
		\VV(f)
		= \left\{ (x_0 : \dots : x_n) \mid f(x_0, \dots, x_n) = 0 \right\}.
	\]
\end{definition}

The homogeneous condition is really necessary.
For example, to require ``$x_0 - 1 = 0$'' makes no sense,
since the points $(1:1:1)$ and $(2015:2015:2015)$ are the same.

It's trivial to verify that homogeneous polynomials do exactly what we want:
hence we can do the following.
\begin{definition}
	A \vocab{projective variety} in $\CP^n$
	is the common zero locus of an arbitrary
	collection of homogeneous polynomials in $n+1$ variables.
\end{definition}

\begin{example}[A Conic in $\CP^2$, or a Cone in $\CC^3$]
	Let's try to picture the variety
	\[ \VV(x^2+y^2-z^2) \subseteq \CP^2 \]
	which consists of the points $[x:y:z]$ such that $x^2+y^2=z^2$.
	If we view this as subspace of $\CC^3$
	(i.e.\ by thinking of $\CP^2$ as the set of lines through the origin),
	then we get a ``cone'':
	\begin{center}
		\includegraphics{cone.pdf}
	\end{center}

	If we take the standard affine charts now, we obtain the following:
	\begin{itemize}
		\ii At $x=1$, we get a hyperbola $\VV(1+y^2-z^2)$.
		\ii At $y=1$, we get a hyperbola $\VV(1+x^2-z^2)$.
		\ii At $z=1$, we get a circle $\VV(x^2+y^2-1)$.
	\end{itemize}
	That said, over $\CC$ a hyperbola and circle
	are the same thing; I'm cheating a little by drawing $\CC$
	as one-dimensional, just like last chapter.
\end{example}
\begin{ques}
	Draw the intersection of the cone above
	with the $z=1$ plane, and check that you do in fact get a circle.
	(This geometric picture will be crucial later.)
\end{ques}

\section{Homogeneous Ideals}
Now, the next thing we want to do is define $\VV(I)$ for an ideal $I$.
Of course, we again run into an issue with things like $x_0-1$ not
making sense. 

The way out of this is to use only \emph{homogeneous} ideals.
\begin{definition}
	If $I$ is a homogeneous ideal, we define
	\[ \VV(I) = \{ x \mid f(x) = 0 \; \forall f \in I\}. \]
\end{definition}
\begin{exercise}
	Show that the notion ``$f(x) = 0 \; \forall f \in I$''
	is well-defined for a homogeneous ideal $I$.
\end{exercise}
So, we would hope for a nullstellensatz-like theorem
which bijects the homogeneous semiprime ideals to the ideals.
Unfortunately:
\begin{example}
	[Irrelevant Ideal]
	To crush some dreams and hopes, consider the ideal
	\[ I = (x_0, x_1, \dots, x_n). \]
	This is called the \vocab{irrelevant ideal};
	it is homogeneous semiprime
	and has the property that $\VV(I) = \varnothing$.
\end{example}

However, other than the irrelavant ideal.
\begin{theorem}
	[Homogeneous Nullstellensatz]
	Let $I$ and $J$ be homogeneous ideals. 
	\begin{enumerate}[(a)]
		\ii If $\VV(I) = \VV(J) \neq \varnothing$ then $\sqrt I = \sqrt J$.
		\ii If $\VV(I) = \varnothing$, then either $I = (1)$
		or $\sqrt I = (x_0, x_1, \dots, x_n)$.
	\end{enumerate}
	Thus there is a natural bijection between:
	\begin{itemize}
		\ii projective varieties in $\CP^n$, and
		\ii homogeneous semiprime ideas of $\CC[x_1, \dots, x_n]$ 
		except for the irrelevant ideal. 
	\end{itemize}
\end{theorem}
\begin{proof}
	For the first part, let $V = \VV(I)$ and $W = \VV(J)$
	be projective varieties in $\CP^n$.
	We can consider them as \emph{affine varieties} in $\Aff^{n+1}$
	by using the interpretation of $\CP^n$
	as lines through the origin in $\CC^n$.

	Algebraically, this is done by taking the homogeneous ideals
	$I, J \subseteq \CC[x_0, \dots, x_n]$
	and using the same ideals to cut out \emph{affine} varieties
	$V_{\text{aff}} = \VV(I)$ and $W_{\text{aff}} = \VV(J)$ in $\Aff^{n+1}$.
	For example, the cone $x^2+y^2-z^2=0$ is a conic in $\CP^2$,
	but can also be thought of as the two-dimensional cone in $\Aff^3$.

	Then for (a), we have $V_{\text{aff}} = W_{\text{aff}}$,
	so $\sqrt I = \sqrt J$.

	For (b), either $V_{\text{aff}}$ is empty 
	or it is just the origin of $\Aff^{n+1}$,
	so the Nullstellensatz implies either $I = (1)$
	or $\sqrt I = (x_0, \dots, x_n)$ as desired.
\end{proof}


\section{As Ringed Spaces}
\prototype{The regular functions on $\CP^1$ minus a point
are exactly those of the form $P(s/t)$.}
Now, let us make every projective variety $V$ into a baby's ringed space.
We already have the set of points, a subset of $\CP^n$.

The topology is defined as follows.
\begin{definition}
	We endow $\CP^n$ with the \vocab{Zariski topology}
	by declaring the sets of the form $\VV(I)$,
	where $I$ is a homogeneous ideal, to be the closed sets.
	
	Every projective variety $V$ then inherits the Zariski
	topology from its parent $\CP^n$.
	The \vocab{distinguished open sets} $D(f)$ are $V \setminus \VV(f)$.
\end{definition}

Thus every projective variety $V$ is now a topological space.
It remains to endow it with a sheaf of regular functions $\OO_V$.
To do this we had to be a little careful.
In the affine case we had a nice little ring of functions,
the coordinate ring $\CC[x_0,\dots,x_n] / I$,
that we could use to provide the numerator and denominators.
So, it seems natural to then define the following:
\begin{definition}
	The \vocab{homogeneous coordinate ring} of a projective variety
	$V = \VV(I) \subseteq \CP^n$, where $I$ is homogeneous semiprime,
	is defined as the ring
	\[ \CC[V] = \CC[x_0, \dots, x_n] / I. \]
\end{definition}
However, when we define rational function we must impose
a new requirement that the numerator and denominator are the same degree.
\begin{definition}
	Let $U \subseteq V$ be an open set of a projective variety $V$.
	A \vocab{rational function} $\phi$ on a projective variety $V$
	is a quotient $f/g$, where $f,g \in \CC[V]$,
	and $f$ and $g$ are homogeneous of the same degree,
	and $\VV(g) \cap U = \varnothing$.
	In this way we obtain a function $\phi : U \to \CC$.
\end{definition}
\begin{example}
	[Examples of Rational Functions]
	Let $V = \CP^1$ have coordinates $(s:t)$.
	\begin{enumerate}[(a)]
		\ii If $U = V$, then constant functions $c/1$
		are the only rational functions on $U$.
		\ii Now let $U_1 = V \setminus \{(1:0)\}$.
		Then, an example of a regular function is
		\[ \frac{s^2+9t^2}{t^2} = \left( \frac st \right)^2 + 9. \]
		If we think of $U_1$ as $\CC$
		(i.e.\ $\CP^1$ minus an infinity point, hence like $\Aff^1$)
		then really this is just the function $x^2+9$.
	\end{enumerate}
\end{example}
Then we can repeat the same definition as before:
\begin{definition}
	Let $U \subseteq V$ be an open set of a projective variety $V$.
	We say a function $\phi : U \to \CC$ is a \vocab{regular function} if
	for every point $p$, we can find an open set $U_p$ containing $p$
	and a rational function $f_p/g_p$ on $U_p$ such that
	\[ \phi(x) = \frac{f_p(x)}{g_p(x)} \qquad \forall x \in U_p. \]
	In particular, we require $U_p \cap \VV(g_p) = \varnothing$.
	We denote the set of all regular functions on $U$ by $\OO_V(U)$.
\end{definition}
Of course, the rational functions from the previous example
are examples of regular functions as well.
This completes the definition of a projective variety $V$
as a baby's ringed space.

\section{Examples of Regular Functions}
Naturally, I ought to tell you what the regular functions
on distinguished open sets are; this is an analog to
\Cref{thm:reg_func_distinguish_open} from last time.
\begin{theorem}
	[Regular Functions on Distinguished Open Sets for Projective Varieties]
	Let $V$ be a variety, and let $g \in \CC[V]$ be homogeneous
	of positive degree.
	Then
	\[
		\OO_V(D(g))
		= \left\{ \frac{f}{g^r} \mid
		f \in \CC[V] \text{ homogeneous of degree $r\deg g$}
		\right\}.
	\]
\end{theorem}
What about the case $g = 1$?
A similar result holds, but we need the assumption that $V$ is irreducible.
(This has the same definition as the affine case,
since ``irreducible'' is an adjective of topological spaces.)
\begin{theorem}
	[Only Constant Regular Functions on Projective Space]
	Let $V$ be an \emph{irreducible} projective variety.
	Then the only regular functions on $V$ are constant,
	thus we have \[ \OO_V(V) \cong \CC. \]
\end{theorem}
Proofs of these are omitted for now.
\begin{example}
	[Regular Functions on $\CP^1$]
	Let $V = \CP^1$, with coordinates $(s:t)$.
	\begin{enumerate}[(a)]
		\ii By theorem, if $U_1$ is the standard affine chart
		omitting the point $(1:0)$, we have
		$ \OO_V(U_1) = \left\{ \frac{f}{t^n} \mid \deg f = n \right\} $.
		One can write this as
		\[ \OO_V(U_1) \cong \left\{ P(s/t) \mid P \in \CC[x] \right\}
			\cong \OO_{\Aff^1} (\Aff^1). \]
		This conforms with our knowledge that $U_1$
		``looks very much like $\Aff^1$''.
		\ii As $V$ is irreducible, $\OO_V(V) = \CC$:
		there are no nonconstant functions on $\CP^1$.
	\end{enumerate}
\end{example}

\begin{example}
	[Regular Functions on $\CP^2$]
	Let $\CP^2$ have coordinates $(x:y:z)$ and 
	let $U_0 = \left\{ (x:y:1) \in \CP^2 \right\}$
	be the distinguished open set $D(z)$.
	Then in the same vein,
	\[
		\OO_{\CP^2}(U_0)
		= \left\{ \frac{P(x,y)}{z^n} \mid \deg P = n \right\}
		\cong \left\{ P(x/z, y/z) \mid P \in \CC[x,y] \right\}.
	\]
\end{example}

\section\problemhead
affine and irreducible projective variety not isomorphic unless point


chapter{Bonus: B\'ezout's Theorem}
In this chapter we discuss B\'ezout's Theorem.
It makes precise the idea that two degree $d$ and $e$
curves in $\CP^2$ should intersect at ``exactly'' $de$ points
In order to make this vision come true:
\begin{itemize}
	\ii We ought to work in $\CP^n$,
	so that for example any two lines intersect.
	\ii We need to account for multiplicities.
	So we will whenever possible work with homogeneous ideals $I$,
	because we want to allow the possibility that $I$ is not semiprime.
\end{itemize}

\section{The Hilbert Function}
Let $I \subseteq \CC[x_0, \dots, x_n]$ be homogeneous.


\chapter{Quasi-Projective Varieties and Regular Maps}
\section{Quasi-Projective Varieties}
Here is yet another type of baby's ringed space,
which will turn out to generalize both affine and projective varieties.
\begin{definition}
	A \vocab{quasi-projective variety} is
	an open set $X$ of a projective variety $V$.
	It is a baby's ringed space $(X, \OO_X)$ too,
	because for any open set $U \subseteq X$
	we simply define $\OO_X(U) = \OO_V(U)$.
\end{definition}
Obviously, every projective variety is quasi-projective.
But now, we can interpret every affine variety $V$
as a quasi-projective variety by noticing that
\[ V \subseteq \Aff^n \to U_0 \subset \CP^n \]
where $U_0$ is the standard affine chart, isomorphic to $\Aff^n$.

\section{Maps of baby's ringed spaces}
In order to make this precise I have to define
what the arrow $\Aff^n \to U_0$ means,
because they are different types of objects;
the former is an affine variety and the latter is a quasi-projective variety.
So, let me actually define a map between \emph{any} baby's ringed spaces:
\begin{definition}
	Let $(X, \OO_X)$ and $(Y, \OO_Y)$
	be baby's ringed spaces.
	A continuous map of topological spaces $f: X \to Y$
	is a \vocab{regular map} if the following condition holds:
	if $U$ is an open subset of $Y$.
	and $\phi \in \OO_Y(U)$ is regular, then the composition
	\begin{diagram}
		f\pre(U) &\rTo^f & U & \rTo^\phi & \CC
	\end{diagram}
	is a regular function in $\OO_X(f\pre(U))$.

	Two baby's ringed spaces are \vocab{isomorphic}
	if there are mutually inverse regular maps between them.
\end{definition}
This is great.
Before this definition, we had three different types of varieties:
\begin{itemize}
	\ii Affine varieties,
	\ii Projective varieties, and
	\ii Quasi-projective varieties.
\end{itemize}
But all three are baby's ringed spaces, now they can
talk to each other, and even be isomorphic.
In particular, let's now finally prove:
\begin{proposition}
	[Projective Space is Locally Affine]
	The standard affine chart $U_0$ of $\CP^n$
	is isomorphic to $\Aff^n$.
\end{proposition}
\begin{proof}
	
\end{proof}<++>


\chapter{Sheaves and Ringed Spaces}
Most of the complexity of the affine variety $V$ earlier comes from $\OO_V$.
This is a type of object called a ``sheaf''.
The purpose of this chapter is to completely define what this sheaf is,
and just what it is doing.

The typical example to keep in mind is a sheaf of
``functions with property $P$'' on a topological space $X$:
for every open set $U$, $\SF(U)$ gives us the ring of functions on $X$.
However, we will work very abstractly and only assume $\SF(U)$
is a ring, without an interpretation as ``functions''.

The payoff for this abstraction is that it will
allow us to define an arbitrary scheme in the next chapter.
Varieties use $\CC[x_1, x_2, \dots, x_n] / I$ as their ``ring of functions'',
and by using the fully general sheaf we will be replace this
with \emph{any} commutative ring.
In particular, we can use the case where $I$ is not semiprime, such as
$\CC[x] / (x^2)$; this gives the ``multiplicity''
behavior that we sought after all along.  

\section{Pre-Sheaves}
\prototype{The sheaf of holomorphic (or regular, continuous,
differentiable, constant, whatever) functions.}

The proper generalization of our $\OO_V$ is a so-called sheaf of rings.
Recall that $\OO_V$ was a took \emph{open sets of $V$} to \emph{rings},
with the interpretation that $\OO_V(U)$ was a ``ring of functions''.

In light of this, we first make the following definition
for the general construct, in the language of categories.

\begin{definition}
	For a topological space $X$ let $\Opens(X)$ denote
	its open sets of $X$.
\end{definition}
\begin{definition}
	A \vocab{pre-sheaf} of rings on a space $X$ is a function
	\[ \SF : \Opens(X) \to \catname{Rings} \]
	meaning each open set gets associated with a ring $\SF(U)$.
	Each individual element of $\SF(U)$ is called a \vocab{section}.
	An element of $\SF(X)$ is called a \vocab{global section}.

	It is also equipped with the following information:
	for any $U_1 \subseteq U_2$ there is a \vocab{restriction map}
	\[ \res_{U_1,U_2} : \SF(U_2) \to \SF(U_1) \]
	such that $\res_{U,U}$ is the identity and
	whenever $U_1 \subseteq U_2 \subseteq U_3$ the diagram
	\begin{diagram}
		\SF(U_3) & \rTo^{\res_{U_2,U_3}} & \SF(U_2) \\
		& \rdTo_{\res_{U_1,U_3}} & \dTo_{\res_{U_1,U_2}} \\
		&& \SF(U_1)
	\end{diagram}
	commutes. (Restricting ``big to medium to small''
	is the same as ``big to small''.)
\end{definition}

\begin{abuse}
	If $s \in \mathscr F(U_2)$ is some section and $U_1 \subseteq U_2$,
	then rather than write $\res_{U_1,U_2}(s)$
	I will write $s\restrict{U_1}$ instead:
	``$s$ restricted to $U_1$''.
	This is abuse of notation because the section $s$ is just
	an element of some ring, and in the most abstract of cases
	may not have a natural interpretation as function.
\end{abuse}

\begin{example}[Examples of Sheaves]
	\listhack
	\begin{enumerate}[(a)]
		\ii For an affine variety $V$, $\OO_V$ is of course a sheaf,
		with $\OO_V(U)$ being the ring of regular functions on $U$.
		The restriction map just says that if $U_1 \subseteq U_2$,
		then a function $s \in \OO_V(U_2)$ can also be thought of as
		a function $s \restrict{U_1} \in \OO_V(U_1)$,
		hence the name ``restriction''.
		The commutativity of the diagram then follows.
		
		\ii Let $X \subseteq \RR^n$ be an open set.
		Then there is a sheaf of smooth/differentiable/etc.\ functions on $X$.
		In fact, one can do the same construction for any manifold $M$.

		\ii Similarly, if $X \subseteq \CC$ is open,
		we can construct a sheaf of holomorphic functions on $X$.
	\end{enumerate}
	In all these examples, the sections $s \in \SF(U)$
	are really functions on the space, but in general they need not be.
\end{example}

Now, we give a second, equivalent and far shorter definition of pre-sheaf:
\begin{abuse}
	By abuse of notation, $\Opens(X)$ will also be thought of as a
	posetal category by inclusion. Thus $\varnothing$ is an initial object
	and the entire space $X$ is a terminal object.
\end{abuse}
\begin{definition}
	A \vocab{pre-sheaf} of rings on $X$ is a contravariant functor
	\[ \SF : \Opens(X)\op \to \catname{Rings}. \]
\end{definition}
\begin{ques}
	Check that these definitions are equivalent.
\end{ques}
It is now clear that we can actually replace $\catname{Rings}$
with any category we want.

So we should think:
\begin{moral}
	Pre-sheaves should be thought of as
	``returning the ring of functions with a property $P$''.
\end{moral}

\section{Sheaves}
\prototype{Constant functions aren't pre-sheaves,
	but locally constant ones are.}

Now, the main idea next is that
\begin{moral}
	Sheaves are pre-sheaves for which $P$ is a \emph{local} property.
\end{moral}

The formal definition doesn't illuminate this as much as the examples
do, but I have to give it first for the examples to make sense.

\begin{definition}
	A \vocab{sheaf} $\mathscr F$ is a pre-sheaf satisfying the following
	two additional axioms:
	Suppose $U$ is covered by open sets $U_\alpha \subseteq U$. Then:
	\begin{enumerate}
		\ii (Identity) If $s, t \in \mathscr F(U)$ are sections,
		and $s\restrict{U_\alpha} = t\restrict{U_\alpha}$
		for all $\alpha$, then $s = t$.
		\ii (Collation) Consider sections
		$s_\alpha \in \mathscr(U_\alpha)$ for each $\alpha$.
		Suppose that 
		\[ s_\alpha \restrict{U_\alpha \cap U_\beta}
			= s_\beta \restrict{U_\alpha \cap U_\beta} \]
		for each $U_\alpha$ and $U_\beta$.
		Then we can find $s \in U$ such that
		$s \restrict{U_\alpha}  = s_\alpha$.
	\end{enumerate}
\end{definition}
This is best illustrated by picture: consider an open cover $U_1 \cup U_2$.
\begin{center}
	\begin{asy}
		size(4cm);
		filldraw(shift(-0.5,0)*unitcircle, lightred+opacity(0.3), red);
		filldraw(shift( 0.5,0)*unitcircle, lightblue+opacity(0.3), blue);
		label("$U_1$", (-0.5,0)+dir(135), dir(135), red);
		label("$U_2$", ( 0.5,0)+dir(45), dir(45), blue);
	\end{asy}
\end{center}
Then for a sheaf of functions, the axioms are saying that:
\begin{itemize}
	\ii If $s$ and $t$ are functions (with property $P$)
	on the whole space $U = U_1 \cup U_2$,
	and $s \restrict{U_1} = t \restrict{U_1}$,
	$s \restrict{U_2} = t \restrict{U_2}$,
	then $s = t$ on the entire union.
	This is clear.

	\ii If $s_1$ is a function with property $P$ on $U_1$
	and $s_2$ is a function with property $P$ on $U_2$,
	and the two functions agree on the overlap,
	then one can collate them to obtain a function $s$
	on the whole space:
	this is obvious, but \textbf{the catch is that the collated function
	needs to have property $P$ as well.}
	That's why it matters that $P$ is local.
\end{itemize}

The reason we need these axioms is that in our abstract definition of a sheaf,
the output of the sheaf is an abstract ring, which need not actually
have a concrete interpretation as ``functions on $X$'', even though
our examples will usually have this property.

Now for the examples, which are more enlightening:
\begin{example}
	[Examples and Non-Examples of Sheaves]
	\listhack
	\begin{enumerate}[(a)]
		\ii Pre-sheaves of arbitrary / continuous / differentiable / smooth
		/ holomorphic functions are still sheaves.
		This is because to verify a function is continuous,
		one only needs to look at small neighborhoods at once.
		
		\ii For a complex variety $V$, $\OO_V$ is a sheaf,
		precisely because our definition was \emph{locally} quotients
		of polynomials.

		\ii The pre-sheaf of \emph{constant} real functions on a space $X$
		is \emph{not} a sheaf, because it fails the collation axiom.
		Namely, suppose that $U_1 \cap U_2 = \varnothing$.
		Then if $s_1$ is the constant function $1$ on $U_1$
		while $s_2$ is the constant function $2$ on $U_2$,
		then we cannot collate these to a constant function on $U_1 \cup U_2$.

		\ii On the other hand, \emph{locally constant} functions
		do produce a sheaf. (A function is locally constant
		if for every point it is constant on some neighborhood.)
	\end{enumerate}
	In fact, the sheaf in (c) is what is called a \emph{sheafification}
	of the pre-sheaf constant functions, which we define momentarily.
\end{example}

\section{Stalks}
\prototype{Germs of real smooth functions tell you the derivatives,
but germs of holomorphic functions determine the entire function.}
Let $\SF$ be a sheaf.
If we have a function $s \in \SF(U)$ and a point $p \in U$,
then in general it doesn't make sense to ask what $s(p)$ is
(even though all our examples look like this),
because $\SF(U)$ is an arbitrary ring.
So, we will replace the notion of $s(p)$ with a so-called \emph{germ}.

\begin{definition}
	Let $\SF$ be a pre-sheaf of rings.
	For every point $p$ we define the \vocab{stalk} $\SF_p$ to be the set
	\[ \left\{ (s, U) \mid s \in \SF(U), p \in U \right\} \]
	modulo the relation $\sim$ that 
	\[ (s_1,U_1) \sim (s_2, U_2) \text{ if }
		s_1 \restrict{U_1 \cap U_2} = s_2 \restrict{U_1 \cap U_2}. \]
	The equivalence classes themselves are called \vocab{germs}.
\end{definition}

\begin{definition}
	The germ of a given $s \in \SF(U)$ at a point $p$
	is the equivalence class for $(s,U) \in \SF_p$.
	We denote this by $[s]_p$.
\end{definition}

So what's happening is:
\begin{moral}
	We consider functions $s$ defined near $p$
	and, since we only care about local behavior,
	we identify any two functions agreeing on a neighborhood of $p$,
	no matter how small.
\end{moral}

Notice that the stalk is itself a ring as well:
for example, addition is done by
\[ 
	\left( s_1, U_1 \right) + \left( s_2, U_2 \right)
	=
	\left( s_1 \restrict{U_1 \cap U_2} + s_2 \restrict{U_1 \cap U_2},
	U_1 \cap U_2 \right).
\]

So the germ $[s]_p$ now plays the role of the ``value'' $s(p)$.
But actually, it carries much more information than that.

\begin{example}
	[Germs of Real Smooth Functions]
	Let $X = \RR$ and let $\SF$ be the sheaf on $X$ of smooth functions
	(i.e.\ $\SF(U)$ is the set of smooth real-valued functions on $U$).

	Consider a global section, $s : \RR \to \RR$ (thus $s \in \SF(X)$)
	and its germ at $0$.
	\begin{enumerate}[(a)]
		\ii From the germ we can read off $s(0)$, obviously.
		\ii We can also find $s'(0)$, because the germ carries enough
		information to compute the limit $\lim_{h \to 0} \frac1h[s(h)-s(0)]$.
		\ii Similarly, we can compute the second derivative and so on.
		\ii However, we can't read off, say, $s(3)$ from the germ.
		For example, take
		\[
			s(x) = \begin{cases}
				e^{-\frac{1}{x-1}} & x > 1 \\
				0 & x \le 1.
			\end{cases}
		\]
		Note $s(3) = e^{-\half}$, but $[\text{zero function}]_0 = [s]_0$.
		So germs can't distinguish between the zero function and $s$.
	\end{enumerate}
\end{example}
\begin{example}
	[Germs of Holomorphic Functions]
	Holomorphic functions are very strange in this respect.
	Consider the sheaf $\SF$ on $\CC$ of holomorphic functions $\CC \to \CC$.

	Take $s : \CC \to \CC$ a global section.
	Given the germ of $s$ at $0$, we can read off $s(0)$, $s'(0)$, et cetera.
	The miracle of complex analysis is that just knowing
	the derivatives of $s$ at zero is enough to reconstruct all of $s$:
	we can compute the Taylor series of $s$ now.
	\textbf{Thus germs of holomorphic functions determine the function};
	they carry much more information than their real counterparts.
	
	In particular, we can concretely describe the sheaf:
	\[
		\SF_p = \left\{
			\sum_{k \ge 0} c_k (z-p)^k,
			\text{ convergent near $p$}
		\right\}.
	\]
	In particular, this includes germs of meromorphic functions,
	so long as there is no pole at $p$ itself.
\end{example}

And of course, our algebraic geometry example.
\begin{abuse}
	Rather than writing $(\OO_V)_p$ we will write $\OO_{V,p}$.
\end{abuse}
\begin{example}
	[Stalks of the Sheaf on an Affine Variety]
	Let $V \subseteq \Aff^n$ be a variety, and assume $p \in V$.
	Then, a regular function $\varphi$ on $U \subseteq V$
	is supposed to be a function on $U$ that ``locally'' is a quotient
	of two functions in $\CC[V]$.

	However, \textbf{as far as the germ is concerned, we only care about
	whichever quotient applies near the point $p$}.
	In light of this, we only think about the representation at $p$,
	and ignore the local clause completely:
	thus the entire stalk can be thought of as
	\[
		\OO_{V,p} = 
		\left\{ \left( \tfrac fg , U \right) \mid 
			p \in U, \; f,g \in \CC[V], \;
			\text{$g \neq 0$ on $U$} \right\}
	\]
	modulo the usual relations.

	Now, since we happen to be working with complex polynomials,
	we know that a rational function is determined by its
	behavior on any neighborhood of $p$
	(complex analysis forever!).
	Thus 
	\[
		\OO_{V,p} =
		\left\{ \tfrac fg \mid f,g \in \CC[V], \; g(p) \neq 0 \right\}.
	\]
	which don't vanish on $p$.
\end{example}

\begin{remark}
	[For category lovers]
	You may notice that $\SF_p$ seems to be
	``all the $\SF_p(U)$ coming together'', where $p \in U$.
	And in fact, $\SF_p(U)$ is the categorical \emph{limit}
	of the diagram formed by all the $\SF(U)$ such that $p \in U$.
	This is often written
	\[ \SF_p = \varinjlim_{U \ni p} \SF(U) \]
	Thus we can define stalks in any category with limits,
	though to be able to talk about germs the category needs
	to be concrete.
\end{remark}

\section{Sheafification}
\prototype{The pre-sheaf of locally constant functions
	becomes the sheaf of constant functions.}
Now that we have the language of germs,
we can define the so-called sheafification.
The idea is that if $\SF$ is the pre-sheaf of ``functions with property $P$''
then we want to associate a sheaf $\SF\sh$ of
``functions which are locally $P$'', which makes them into a sheaf.
We have already seen two examples of this:
\begin{example}
	[Sheafification]
	\listhack
	\begin{enumerate}[(a)]
		\ii If $X$ is a topological space,
		and $\SF$ is the pre-sheaf of constant functions on $X$,
		then $\SF\sh$ is the sheaf of locally constant functions.

		\ii If $V$ is an affine variety,
		and $\SF$ is the pre-sheaf of rational functions,
		then $\SF\sh$ is the sheaf of regular functions
		(which are locally rational).
	\end{enumerate}
\end{example}

So how do we encode ``locally $P$''?
The way we do this is by considering a sequence of germs,
one at every point, such that at any point they can locally be put
together to form a section.

\begin{definition}
	Let $\SF$ be pre-sheaf.
	For an open set $U$, a sequence $(g_p)_{p \in U}$ of germs
	($g_p \in \SF_p$) is said to be \vocab{compatible} if
	they can be ``locally collated'':
	\begin{quote}
		For any $p \in U$ there exists a $s \in \SF(U_p)$
		such that $[s]_q = g_q$ for each $q \in U_p$.
		(Here $U_p$ is any neighborhood of $p$.)
	\end{quote}
	Intuitively, the germs should ``collate together'' to some section near
	each \emph{individual} point $p$
	(but not necessarily to a section in $\SF(U)$).
\end{definition}
\begin{definition}
	The \vocab{sheafification} $\SF\sh$ of a pre-sheaf $\SF$ is defined by
	\[ \SF\sh(U) =
		\left\{ \text{sequences of compatible
		germs $(g_p)_{p \in U}$} \right\}.  \]
\end{definition}
\begin{exercise}
	Reconcile this definition with the two examples we gave.
\end{exercise}
\begin{abuse}
	Technically I haven't told you what the restriction morphisms of $\SF(U)$
	are but, they are not hard to guess.
	I'll usually be equally sloppy in the future:
	when defining a sheaf $\FF$, I'll only say what $\FF(U)$ is,
	with the restriction morphisms $\FF(U_2) \to \FF(U_1)$ being implicit.
\end{abuse}
The construction is contrived so that given a section
$(g_p)_{p \in U} \in \SF\sh(U)$ the germ at a point $p$ is $g_p$:
\begin{lemma}
	[Pre-Sheaves and Sheaves Have the Same Stalk]
	\label{lem:pre_sheaf_stalk}
	Let $\SF$ be a pre-sheaf and $\SF\sh$ its sheafification.
	Let $q \in U$ with $U$ an open set.
	Then there is an isomorphism
	\[ (\SF\sh)_q \cong \SF_q. \]
\end{lemma}
\begin{proof}
	A germ in $(\SF\sh)_q$ looks like 
	$\left( U, (g_p)_{p \in U} \right)$, where $g_p$ are germs of $\SF_p$.
	Then the isomorphism is given by
	\[ \left( U, (g_p)_{p \in U} \right) \mapsto g_q \in \SF_q. \]
	The inverse map is given by for each $g = (s,U) \in \SF_q$ by
	\[ g \mapsto \left( (g)_{p \in U}, U \right) \]
	i.e.\ the sequence of germs is the constant sequence.
\end{proof}

\section{Local Rings}
\prototype{Smooth functions $f$ on $X \subseteq \RR^n$ have invertible
germs at $p$ unless $f(p) = 0$.}
The stalks of the examples we produced above are special types
of rings, called \emph{local rings}.
Algebraically, the definition of these is:
\begin{definition}
	A \vocab{local ring} $R$ is a ring with exactly one maximal ideal.
\end{definition}
\begin{exercise}
	Show that a ring $R$ is a local ring if there exists
	a proper ideal $\mm \subsetneq R$ such that
	all elements of $R \setminus \mm$ are units.
	(Bonus: prove the converse.)
\end{exercise}

% Wikipedia has a good explanation here
To see why this definition applies to the stalks above,
we need to identify what the maximal ideal is.
Let's go back to the example of $X = \RR$ and $\SF(U)$ the smooth functions,
and consider the stalk $\SF_{p}$, where $p \in X$.
Define the ideal $\mm_p$ to be the set of germs $(s,U)$ for which $s(p) = 0$.

Then $\mm_p$ is maximal: we have an exact sequence
\[ 0 \to \mm_p \to \SF(U) \taking{(s,U) \mapsto s(p)} \RR \to 0 \]
and so $\SF(U) / \mm_p \cong \RR$, which is a field.

It remains to check there are no nonzero maximal ideals.
Now note that if $s \notin \mm_p$,
then $s$ is nonzero in some neighborhood of $p$,
then one can construct the function $1/s$ in a neighborhood of $p$.
So \textbf{every element of $\SF_p \setminus \mm_p$ is a unit};
$\mm_p$ is in fact the only maximal ideal!

More generally, any time a sheaf $\SF$ is of the form
``nice field-valued functions'',
the stalk $\SF_p$ usually has a maximal ideal
consisting of the germs vanishing at $p$.
The discussion above implies, for example, the following.
\begin{proposition}
	[Stalks Are Often Local Rings]
	The stalks of each of the following types of sheaves are local rings:
	\begin{enumerate}[(a)]
		\ii Sheaves of continuous real/complex functions on a topological space
		\ii Sheaves of smooth functions on any manifold
		\ii Regular functions on an algebraic variety $V$.
	\end{enumerate}
\end{proposition}

\section{Locally Ringed Space}
We can now define:
\begin{definition}
	A \vocab{ringed space} is a topological space $X$ equipped
	with a sheaf $\OO_X$ of rings.
	Suppose that for every point $p$, the stalk $\OO_{X,p}$
	is a local ring.
	Then we say that $\OO_X$ is a \vocab{locally ringed space}.
	We denote the maximal ideals by $\mm_{X,p}$.
\end{definition}

In particular, in the previous chapter we showed that every
affine variety could be built into a locally ringed space. Hooray!
\begin{abuse}
	A ringed space $(X, \OO_X)$ is abbreviated to just $X$,
	while $p \in X$ means ``$p$ is in the topological space $X$''.
\end{abuse}


\section{(Optional) Defining the Morphisms}
Finally, it remains to define a morphism of locally ringed space.
To do this we have to build up in several steps.

\begin{remark}
	This is marked as optional because it involves a \emph{lot}
	of definitions, and because we will more or less
	ignore the actual definition later on when we start applying
	schemes to things. One can probably get away with just
	suspending belief and knowing ``there is a reasonable definition
	of morphisms of locally ringed spaces''.
\end{remark}

\subsection*{Morphisms of Pre-Sheaves and Sheaves}
First, recall that a sheaf is a contravariant functor (pre-sheaf)
with extra conditions. In light of this, it is not hard to guess
the definition of a morphism of pre-sheaves:
\begin{definition}
	A \vocab{morphism of (pre-)sheaves} $\alpha : \SF \to \SG$ on the same
	space $X$ is a \textbf{natural transformation} of the underlying functors.
	Isomorphism of sheaves is defined in the usual way.
\end{definition}
\begin{ques}
	Show that this amounts to: for each $U \subseteq X$ we need to specify
	a morphism $\alpha_U : \SF(U) \to \SG(U)$ such that the diagram
	\begin{diagram}
		\SF(U_2) & \rTo^{\alpha_{U_2}} & \SG(U_2) \\
		\dTo^{\res_{U_1, U_2}} && \dTo_{\res_{U_1, U_2}} \\
		\SF(U_1) & \rTo_{\alpha_{U_1}} & \SG(U_1)
	\end{diagram}
	commutes any time that $U_1 \subseteq U_2$.
\end{ques}

\subsection*{Morphisms of Ringed Spaces}
This is more involved.
Suppose we have ringed spaces $X = (X, \OO_X)$ and $Y = (Y, \OO_Y)$,
and we want to define a map
\[ f : X \to Y. \]

On the level of spaces, $f : X \to Y$ should of course be a continuous map.
But we also want to $f$ to do something with $\OO_X$ and $\OO_Y$.
However, we only defined how to take a morphism of sheaves
that act on the \emph{same} space!
Thus we impose the following definition,
which lets us \emph{push} the sheaf on $X$ to a sheaf on $Y$.
Picture:
\begin{diagram}
	X && \rTo^f & Y && X && \rTo^f & Y \\
	\Opens(X)\op && \lTo^{f\pre} & \Opens(Y)\op
	&& f\pre(U) && \lMapsto^{f\pre} & U & \\
	& \rdMapsto(3,2)_{\SF} && \dMapsto_{f_\ast \SF}
		&& & \rdMapsto(3,2)_{\SF} && \dMapsto_{f_\ast \SF} & \\
	&&& \catname{Rings}
		&& && \SF(f\pre(U)) & = (f_\ast \SF)(U) & \in \catname{Rings}
\end{diagram}

\begin{definition}
	Let $\SF$ be a sheaf on $X$, and $f : X \to Y$ a continuous map.
	The \vocab{pushforward sheaf} $f_\ast \SF$ on $Y$ is defined by
	\[ (f_\ast \SF)(U) = \SF(f\pre(U)) \qquad \forall U \subseteq Y. \]
	This makes sense, since $f\pre(U)$ is open in $X$.
\end{definition}
As $f\pre$ is a functor $\Opens(Y)\op \to \Opens(X)\op$,
\textbf{the pushforward $f_\ast\SF$ is
just the composition of these two functors}.

\begin{ques}
	Technically $f_\ast\SF$ is supposed to be a
	functor $\Opens(Y)\op \to \catname{Rings}$, so it also needs
	to come with restriction arrows. What are they?
\end{ques}

I haven't actually checked that $f_\ast \SF$ is a sheaf
(as opposed to a pre-sheaf), but this isn't hard to do.

Now we can define a morphism of ringed spaces.
In addition to the topological spaces,
we also include a natural transformation between
the two structure sheafs, after pushing the one on $X$ forward.
\begin{definition}
	A \vocab{morphism of ringed spaces} $f : (X, \OO_X) \to (Y, \OO_Y)$
	consists of a continuous map of topological spaces $f : X \to Y$,
	as well as a morphism of sheaves $f^\ast : \OO_Y \to (f_\ast \OO_X)$.
\end{definition}
The latter is thus a map
$f^\ast_U : \OO_Y(U) \to (f_\ast \OO_X)(U) = \OO_X(f\pre(U))$
for every $U \subseteq Y$, satisfying
the axioms for a natural transformation.

\subsection*{Morphisms of Locally Ringed Spaces}
Last step!
Suppose now that $(X, \OO_X)$ and $(Y, \OO_Y)$ are locally ringed spaces.
Thus we need to deal with some information about the stalks.

Given a morphism of ringed spaces $f : (X, \OO_X) \to (Y, \OO_Y)$,
we can actually use the $f^\ast_U$ above to induce maps on the stalks,
as follows. For a point $p \in X$, construct the map
\begin{diagram}
	f^\ast_P :& \OO_{Y, f(p)} & \rTo && \OO_{X, f(p)} \\
	& (s, U) & \rMapsto && (f^\ast_U(s), f\pre(U)).
\end{diagram}
where $s \in \OO_Y(U)$.

\begin{definition}
	Let $R$ and $S$ be local rings with maximal ideals $\mm_R$ and $\mm_S$.
	A \vocab{morphism of local rings} is a homomorphism of rings
	$\psi : R \to S$ such that $\psi\pre(\mm_S) = \mm_R$.
\end{definition}
\begin{definition}
	A \vocab{morphism of locally ringed spaces}
	is a morphism of ringed spaces $f : (X, \OO_X) \to (Y, \OO_Y)$ such that
	for every point $p$ the induced map of stalks is a morphism of local rings.
\end{definition}
Recalling that $\mm_{X,p}$ is the maximal ideal of $\OO_X$ at $p$,
the new condition is saying that
\[ (f^\ast_P)\pre (\mm_{X,p}) = \mm_{Y,f(p)}. \]
Concretely, if $g$ is a function which vanishes on $f(p)$,
then its ``pullback'' $f^\ast_U(g)$ vanishes on $p$.

This completes the definition of a morphism of locally ringed spaces.
Isomorphisms of (locally) ringed spaces are defined in the usual way.

\section\problemhead
\begin{problem}
	Prove that if $\SF$ is a sheaf, then $\SF \cong \SF\sh$.
\end{problem}
\begin{sproblem}
	[Global Section Functor]
	We consider the category $\catname{ShRing}_X$ of sheaves of rings on a space $X$.
	The \vocab{global section functor}, denoted $\Gamma(X,-)$,
	which sends each sheaf $\SF$ to the ring $\SF(X)$.
	How does the global section functor behave on arrows?
	\begin{hint}
		Given a morphism of sheaves $\alpha : \SF \to \SG$
		read off a map $\SF(X) \to \SG(X)$.
	\end{hint}
\end{sproblem}

\chapter{Schemes}
Now that we understand sheaves well, we can readily define the scheme.
It will be a locally ringed space, so we need to define
\begin{itemize}
	\ii The set of points,
	\ii The topology on it, and
	\ii The structure sheaf on it.
\end{itemize}

In the case of $\Aff^n$, we used $\CC^N$ as the set of points
and $\CC[x_1, \dots, x_n]$ but then remarked that the set of points
of $\CC^n$ corresponded to the maximal ideals of $\CC[x_1, \dots, x_n]$.

In an \emph{affine scheme}, we will take an \emph{arbitrary} ring $R$,
and generate the entire structure from just $R$ itself.
The final result is called $\Spec R$, the \vocab{spectrum} of $R$.
The affine varieties $\VV(I)$ we met earlier will just be
$\CC[x_1, \dots, x_n] / I$, but now we will be able to take
\emph{any} ideal $I$, thus finally completing the table at the end
of the ``affine variety'' chapter.

In particular, $\Spec \CC[x] / (x^2)$ will be the double we sought for so long.

\section{The Set of Points}
\prototype{$\Spec \CC[x_1, \dots, x_n] / I$.}

First surprise, for a ring $R$:
\begin{moral}
	$\Spec R$ is defined as the set of prime ideals of $R$.
\end{moral}

This might be a little surprising, since we might have guessed
that $\Spec R$ should just have the maximal ideals.
What do the remaining ideals correspond to?
The answer is that they will be so-called \emph{generic points}
points which are ``somewhere'' in the space, but nowhere in particular.

\begin{remark}
	As usual $R$ itself is not a prime ideal, but $(0)$
	does if $R$ is an integral domain.
\end{remark}

\begin{example}
	[Examples of Spectrums]
	\listhack
	\begin{enumerate}[(a)]
		\ii $\Spec \CC[x]$ consists of a point $(x-a)$ for every $a \in \CC$,
		which correspond to what we geometrically think of as $\Aff^1$.
		In additionally consists of a point $(0)$,
		which we think of as a ``generic point'', nowhere in particular.

		\ii $\Spec \CC[x,y]$ consists of points $(x-a,y-b)$
		(which are the maximal ideals) as well as $(0)$ again, a generic
		point that is thought of as ``somewhere in $\CC^2$,
		but nowhere in particular''.
		It also consists of generic points corresponding to irreducible
		polynomials $f(x,y)$, for example $(y-x^2)$,
		which is a ``generic point on the parabola''.

		\ii If $k$ is a field, $\Spec k$ is a single point,
		since the only maximal ideal of $k$ is $(0)$.
	\end{enumerate}
\end{example}
\begin{example}
	[Complex Affine Varieties]
	Let $I \subseteq \CC[x_1, \dots, x_n]$ be an ideal.
	Then \[ \Spec \CC[x_1, \dots, x_n] /I \] contains a
	point for every closed irreducible subvariety of $\VV(I)$.
	So in addition to the ``geometric points'' we have
	``generic points'' along each of the varieties.
\end{example}
\begin{example}
	[More Examples of Spectrums]
	\listhack
	\begin{enumerate}[(a)]
		\ii $\Spec \ZZ$ consists of a point for every prime $p$,
		plus a generic point that is somewhere, but no where in particular.

		\ii $\Spec \CC[x] / (x^2)$ has only $(x)$ as a prime ideal.
		The ideal $(0)$ is not prime since $0 = x \cdot x$.
		Thus as a \emph{topological space},
		$\Spec \CC[x] / (x^2)$ is a single point.
		
		\ii $\Spec \Zc{60}$ consists of three points.
		What are they?
	\end{enumerate}
\end{example}

\section{The Zariski Topology of the Spectrum}
\prototype{Still $\Spec \CC[x_1, \dots, x_n] / I$.}

Now, we endow a topology on $\Spec R$.
Since the points on $\Spec R$ are the prime ideals, we continue
the analogy by thinking of the points $f$ as functions on $\Spec R$. That is,
\begin{definition}
	Let $f \in R$ and $\pp \in \Spec R$.
	Then the \vocab{value} of $f$ at $\pp$ is defined to be $f \pmod{\pp}$.
	We denote it $f(\pp)$.
\end{definition}
\begin{example}
	[Vanishing Locii in $\Aff^n$]
	Suppose $R = \CC[x_1, \dots, x_n]$,
	and $\pp = (x_1-a_1, x_2-a_2, \dots, x_n-a_n)$ is a maximal ideal of $R$.
	Then for a polynomial $f \in \CC$,
	\[ f \pmod \pp = f(a_1, \dots, a_n) \]
	with the identification that $\CC/\pp \cong \CC$.
\end{example}
Indeed if you replace $R$ with $\CC[x_1, \dots, x_n]$
and $\Spec R$ with $\Aff^n$ in everything that follows,
then everything will be clear.

\begin{definition}
	Let $f \in R$. We define the \vocab{vanishing locus} of $f$ to be
	\[ \VV(f) = \left\{ \pp \in \Spec R \mid f(\pp) = 0 \right\}
		= \left\{ \pp \in \Spec R \mid f \in \pp \right\}. \]
	More generally, just as in the affine case,
	we define the vanishing locus for an ideal $I$ as
	\begin{align*}
		\VV(I) &= \left\{ \pp \in \Spec R \mid f(\pp)=0 \forall f \in I \right\} \\
		&= \left\{ \pp \in \Spec R \mid f \in \pp \; \forall f \in I \right\} \\
		&= \left\{ p \in \Spec R \mid I \subseteq \pp \right\}.
	\end{align*}
	Finally, we define the \vocab{Zariski topology} on $\Spec R$
	by declaring that the sets of the form $\VV(I)$ are closed.
\end{definition}

Now, the following topological notion will come in handy:
\begin{definition}
	A point $p \in X$ is a \vocab{closed point} if the set $\{p\}$ is closed.
\end{definition}
\begin{ques}
	Show that $\pp \in \Spec R$ is a closed point
	if and only if $\pp$ is a maximal ideal.
\end{ques}
Therefore the Zariski topology lets us refer back to the old ``geometric''
as just the closed points.
\begin{example}
	[Generic Points, Continued]
	Let $R = \CC[x,y]$ and let $\pp = (y-x^2) \in \Spec \RR$;
	this is the ``generic point'' on a parabola.
	It is not closed, but we can compute its closure:
	\[
		\ol{\{\pp\}}
		= \VV(\pp) = \left\{ \qq \in \Spec R \mid \qq \supseteq \pp \right\}.
	\]
	This closure contains the point $\pp$ as well
	as several maximal ideals $\qq$, such as $(x-2,y-4)$ and $(x-3,y-9)$.
	In other words, the closure of the ``generic point'' of the parabola
	is literally the set of all points that are actually on the parabola
	(including generic points).

	That means the way to picture $\pp$ is a point that 
	is ``somewhere on the parabola'', but nowhere in particular.
	It makes sense then that if we take the closure,
	we get the entire parabola,
	since $\pp$ ``could have been'' any of those points.
\end{example}
The previous example illustrates the following important observation:
\begin{exercise}
	Let $I \subsetneq R$ be a proper ideal.
	Construct a bijection between the maximal ideals of $R$ containing $I$,
	and the maximal ideals of $R/I$.
	(\cite{ref:vakil} labels this exercise as
	``Essential Algebra Exercise (Mandatory if you haven't done it before)''.)
\end{exercise}

\begin{example}
	[The Generic Point of the $y$-Axis Isn't on the $x$-Axis]
	Let $R = \CC[x,y]$ again.
	Consider $\VV(y)$, which is the $x$-axis of $\Spec R$.
	Then consider $\pp = (x)$, which is the generic point on the $y$-axis.
	Observe that
	\[ \pp \notin \VV(y). \]
	The geometric way of saying this is that a \emph{generic point}
	on the $y$-axis does not lie on the $x$-axis.
\end{example}

Finally, as before, we can define distinguished open sets,
which form a basis of the Zariski topology.
\begin{definition}
	Let $f \in \Spec R$.
	Then $D(f)$ is the set of $\pp$ such that $f(\pp) \neq 0$,
	a \vocab{distinguished open set}.
	These open sets form a basis for the Zariski topology on $\Spec R$.
\end{definition}

\section{The Structure Sheaf}
\prototype{Still $\CC[x_1, \dots, x_n] / I$.}

We have now endowed $\Spec R$ with the Zariski topology,
and so all that remains is to put a sheaf $\OO_{\Spec R}$ on it.
To do this we want a notion of ``regular functions'' as before.

In order for this to make sense, we have to talk about rational
functions in a meaningful way.
If $R$ was an integral domain, then we could just use the field of fractions;
for example if $R = \CC[x_1, \dots, x_n]$ then we could just
look at rational quotients of polynomials.

Unfortunately, in the general situation $R$ may not be an integral domain:
for example, the ring $R = \CC[x] / (x^2)$ corresponding to the double point.
So we will need to define something a little different:
we will construct the \emph{localization} of $R$ at a set $S$,
which we think of as the ``set of allowed denominators''.

\begin{definition}
	Let $S \subseteq R$, where $R$ is a ring,
	and assume $S$ is closed under multiplication.
	Then the \vocab{localization of $R$ at $S$}, denoted $S\inv R$,
	is defined as the set of fractions
	\[ \left\{ r/s \mid r \in R, s \in S \right\} \]
	where we declare two fractions $r_1 / s_1 = r_2 / s_2$ 
	to be equal if 
	\[ \exists s \in S : \quad s(r_1s_2 - r_2s_1) = 0. \]
\end{definition}
In particular, if $0 \in S$ then $S\inv R$ is the trivial ring.
So we usually only take situations where $0 \notin S$.
\begin{ques}
	Assume $R$ is an integral domain and $S = R \setminus \{0\}$.
	Show that $S\inv R$ is just the field of fractions.
\end{ques}

\begin{example}
	[Why the extra $s$?]
	The reason we need the condition $s(r_1s_2 - r_2s_1) = 0$
	rather than the simpler $r_1s_2 - r_2s_1 = 0$ is that
	otherwise the equivalence relation may fail to be transitive.
	Here is a counterexample: take
	\[ R = \Zc{12} \qquad S = \{ 0, 4, 8 \}. \]
	Then we have for example
	\[ \frac12 = \frac24 = \frac64 = \frac32. \]
	So we need to have $\frac12=\frac32$ which is only true
	with the first definition.

	Of course, if $R$ is an integral domain (and $0\notin S$)
	then this is a moot point.
\end{example}

The most important special case is the localization at a prime ideal.
\begin{definition}
	Let $R$ be a ring and $\pp$ a prime ideal.
	Then $R_\pp$ is defined to be $S\inv R$ for $S = R\setminus\pp$.
	We call this \vocab{localization at $\pp$}.
	Addition is defined in the obvious way.
\end{definition}
\begin{ques}
	Why is $S$ multiplicative closed in the above definition?
\end{ques}
Thus,
\begin{moral}
	If $R$ is functions on the space $\Spec R$,
	we think of $R_\pp$ as rational quotients $f/g$ where $g(\pp) \neq 0$.
\end{moral}
In particular, if $R = \CC[x_1, \dots, x_n]$
then this is precisely the definition of rational function from before!

Now, we can define the sheaf as ``locally rational'' functions.
This is done by a sheafification.
First, let $\SF$ be the pre-sheaf of ``globally rational'' functions:
i.e.\ we define $\SF(U)$ to be the following localization of $R$
to the functions vanishing outside $U$:
\[
	\SF(U) = \left\{ 
		\frac fg \mid f, g \in R
		\text{ and } g(\pp) \neq 0 \; \forall \pp \in U
	\right\}
	= \left(R \setminus \bigcup_{\pp \in U} \pp \right)\inv R.
\]
For every $\pp \in U$ we can view $f/g$ as an element in $R_\pp$
(since $g(\pp) \ne 0$).
As one might expect this is an isomorphism
\begin{lemma}[Stalks of the ``Globally Rational'' Pre-Sheaf]
	\label{lem:global_rational_stalk}
	The stalk of $\SF$ defined above $\SF_\pp$ is isomorphic to $R_\pp$.
\end{lemma}
\begin{proof}
	There is an obvious map $\SF_\pp \to R_\pp$ on germs by
	\[
		\left(U, f/g \in \SF(U) \right)
		\mapsto f/g \in R_\pp . \]
	(Note the $f/g$ on the left lives in
	$\SF(U) = \left(R \setminus \bigcup_{\pp \in U} \pp \right)\inv R$
	but the one on the right lives in $R_\pp$).
	Now suppose $(U_1, f_1 / g_1)$ and $(U_2, f_2 / g_2)$
	are germs with $f_1/g_1 = f_2/g_2 \in R_\pp$.
	\begin{exercise}
		Now, show both germs are equal to $(U_1 \cap U_2 \cap D(h), f_1 / g_1)$
		with $D(h)$ the distinguished open set.
	\end{exercise}
	It is also surjective, since given $f/g \in R_\pp$ we take $U = D(g)$
	the distinguished open set for $g$.
\end{proof}

Then, we set \[ \OO_{\Spec R} = \SF\sh. \]
In fact, we can even write out the definition of the sheafification,
by viewing the germ at each point as an element of $R_\pp$.
\begin{definition}
	Let $R$ be a ring. Then $\Spec R$ is made into a ringed space by setting
	\[ \OO_{\Spec R}(U) 
		= \left\{ (f_\pp \in R_\pp)_{\pp \in U}
		\text{ which are locally $f/g$} \right\}. \]
	That is, it consists of sequence $(f_\pp)_{\pp \in U}$, with
	each $f_\pp \in R_\pp$, such that for every point $\pp$ there
	is a neighborhood $U_\pp$ and an $f,g \in R$ such that
	$f_\qq = \frac fg \in R_\qq$ for all $\qq \in U_\pp$.
\end{definition}

\section{Properties of Affine Schemes}
Now that we're done defining an affine scheme,
we state some important results about them.

\begin{definition}
	For $g \in R$, we define the \vocab{localization of $R$ at $g$},
	denoted $R_g$ to be $\{1, g, g^2, g^3, \dots\}\inv R$.
	(Note that $\left\{ 1, g, g^2, \dots \right\}$ is multiplicatively closed.)
\end{definition}
This is admittedly somewhat terrible notation, since $R_\pp$
is the localization with multiplicative set $R \setminus \pp$,
while $R_g$ is the localization with multiplicative set $\{1,g,g^2,\dots\}$;
these two are quite different beasts!

\begin{example}
	[Localization at an Element]
	Let $R = \CC[x,y,z]$ and let $g = x$.
	Then
	\[ R_g = \left\{ \frac{P(x,y,z)}{x^n} \mid
		P \in \CC[x,y,z], \; n \ge 0 \right\}. \]
\end{example}
\begin{theorem}
	[On the Affine Structure Sheaf]
	Let $R$ be a ring and $\Spec R$ the associated affine scheme.
	\begin{enumerate}[(a)]
		\ii Let $\pp$ be a prime ideal.
		Then $\OO_{\Spec R, \pp} \cong R_\pp$.
		\ii Let $D(g)$ be a distinguished open set.
		Then $\OO_{\Spec S}(D(g)) \cong R_g$.
	\end{enumerate}
\end{theorem}
This matches the results that we've seen when $\Spec R$ is an affine variety.
\begin{proof}
	Part (a) follows by \Cref{lem:global_rational_stalk}
	and \Cref{lem:pre_sheaf_stalk}.
	For part (b), we need the following:
	\begin{ques}
		If $I$ and $J$ are ideals of a ring $R$,
		then $\VV(I) \subseteq \VV(J)$ if and only if
		$\sqrt{J} \subseteq \sqrt{I}$.
		(Use the fact that $\sqrt I = \cap_{I \subseteq \pp} \pp$.)
	\end{ques}
	Then we can repeat the proof of \Cref{thm:reg_func_distinguish_open}.
\end{proof}

\begin{theorem}
	[Affine Schemes and Commutative Rings are the Same Category]
	Let $R$ and $S$ be rings.
	There is a natural bijection between maps of schemes $\Spec R \to \Spec S$	
	and ring homomorphisms $\psi : S \to R$.
\end{theorem}
\begin{proof}
	First, we need to do the construction:
	given a map of schemes $f : \Spec R \to \Spec S$ 
	we need to construct a homomorphism $S \to R$.
	This should be the easy part, because $f$ has a lot of data.
	Indeed, recall that for every $U \subseteq \Spec S$
	there is supposed to be a map
	\[ f^\ast_U : \OO_{\Spec S} (U) \to \OO_{\Spec R}(f\pre(U)). \]
	If we take $U$ to be the entire space $\Spec S$ we now have a ring homomorphism
	\[ S = \OO_{\Spec S} (\Spec S) \to \OO_{\Spec R} (\Spec R) = R. \]
	which is one part of the construction.

	In fact, this is just the global section functor
	applied to $\OO_{\Spec S} \to f_\ast \OO_{\Spec R}$.

	The more involved direction is building from a homomorphism
	$\psi : S \to R$ a map $f : \Spec R \to \Spec S$.
	We define it by:
	\begin{itemize}
		\ii On points, $f(\pp) = \psi\pre(\pp)$ for each prime ideal $\pp$.
		One can check $\psi\pre(\pp)$ is indeed prime
		and that $f$ is continuous in the Zariski topology.
		\ii We first construct a map on the stalks of the sheaf as follows:
		for every prime ideal $\qq$ in $R$, let $\psi``(\qq) = \pp$ be its image
		(so that $f(\qq) = \pp$) and consider the map
		\[ \psi_\qq : \OO_{\Spec S, \qq} = S_{\qq}
			\to R_{\psi``(\qq)} = \OO_{\Spec R, \psi``(\qq)}
			\quad\text{by}\quad f/g \mapsto \psi(f)/\psi(g). \]
		Again, one can check this is well-defined and a map of local rings.
		This is called the localization of $\psi$ at $\qq$.
		\ii Finally, we use the above map to construct an
		$f^\ast_U : \OO_{\Spec S}(U) \to \OO_{\Spec R}(f\pre(U))$
		for every open set  $U \subseteq \Spec S$.
		Since $\OO_{\Spec S}$ is a sheafification, we think of its
		sections as sequences of compatible germs $(g_\qq)_{\qq \in U}$
		and then map it via the map $\psi_\qq$ above.
	\end{itemize}
	One then has to check that everything is well-defined.
	This is left as an exercise to the overzealous reader;
	for an actual proof see \cite[Proposition 6.3.2]{ref:vakil}.
\end{proof}
\begin{remark}
	Categorically, this says that the ``global section functor''
	on the category $\catname{AffSch}$ of affine schemes is a
	fully faithful functor to $\catname{CRing}$.
	Moreover, it is surjective on objects
	(the correct term here is ``essentially surjective on objects'').
\end{remark}
To be more philosophical,
\begin{moral}
	The category of affine schemes and the
	category of commutative rings are \emph{exactly the same},
	down to the morphisms between two pairs of objects.
\end{moral}


\section{Schemes}
Now we can define a general scheme:
\begin{definition}
	A \vocab{scheme} is a locally ringed space $(X, \OO_X)$
	with an open affine cover $\{U_\alpha\}$ of $X$
	such that each pair $(U_\alpha, \OO_X \restrict{U_\alpha})$
	is isomorphic to an affine scheme.
\end{definition}
Hooray!

\section{Projective Scheme}
\prototype{Projective varieties, in the same way.}
The most important class of schemes which are not affine are
\emph{projective} schemes.
The complete the obvious analogy:
\[
	\frac{\text{Affine variety}}{\text{Projective variety}}
	= 
	\frac{\text{Affine scheme}}{\text{Projective scheme}}.
\]
Let $R$ be \emph{any} (commutative) graded ring, like $\CC[x_0, \dots, x_n]$.
\begin{definition}
	We define $\Proj R$, the \vocab{projective scheme over $R$}:
	\begin{itemize}
		\ii As a set, $\Proj R$ consists of \emph{homogeneous prime ideals}
		$\pp$ which do not contain $R^+$.
		\ii If $I \subseteq R$ is homogeneous, then
		we let $\VV(I) = \{ \pp \in \Proj R \mid \pp \subseteq I \}$.
		Then the \vocab{Zariski topology} is imposed by declaring 
		sets of the form $\VV(I)$ to be closed.
		\ii We now define a pre-sheaf $\SF$ on $\Proj R$ by
		\[ \SF(U) = 
			\left\{ \frac{f}{g} \mid 
			g(\pp) \neq 0 \; \forall \pp \in U \text{ and }
			f,g \in R^d \text{ for some $d$}
			\right\}.
		\]
		In other words, the rational functions are quotients $f/g$
		where $f$ and $g$ are \emph{homogeneous of the same degree}.
		Then we let \[ \OO_{\Proj R} = \SF\sh \] be the sheafification.
	\end{itemize}
\end{definition}
\begin{definition}
	The \vocab{distinguished open sets} $D(f)$ of the $\Proj R$
	are defined as $\left\{ \pp \in \Proj R : f(\pp) \neq 0 \right\}$,
	as before; these form a basis for the Zariski topology of $\Proj R$.
\end{definition}
Now, we want analogous results as we did for affine structure sheaf.
So, we define a slightly modified localization:
\begin{definition}
	Let $R$ be a graded ring.
	\begin{enumerate}[(i)]
		\ii For a prime ideal $\pp$, let
		\[ R_{(\pp)} = \left\{ \frac fg \mid g(\pp) \neq 0 \text{ and }
			f, g \in R^d \text{ for some $d$} \right\} \]
		denote the elements of $R_\pp$ with ``degree zero''.
		\ii For any homogeneous $g \in R$ of degree $d$, let
		\[ R_{(g)} = \left\{ \frac{f}{g^r} \mid 
			f \in R^{rd} \text{ for some $r$, $d$} \right\} \]
		denote the elements of $R_g$ with ``degree zero''.
	\end{enumerate}
\end{definition}

\begin{theorem}
	[On the Projective Structure Sheaf]
	Let $R$ be a graded ring and let $\Proj R$ the associated projective scheme.
	\begin{enumerate}[(a)]
		\ii Let $\pp \in \Proj R$.
		Then $\OO_{\Spec R, \pp} \cong R_{(\pp)}$.
		\ii Let $g \in R^d$ be homogeneous of degree $d > 0$. Then
		\[ D(g) \cong \Spec R_{(g)} \]
		as locally ringed spaces.
	\end{enumerate}
\end{theorem}
\begin{ques}
	Conclude that $\Proj R$ is a scheme.
\end{ques}

Of course, the archetypal example is that
\[ \Proj \CC[x_0, x_1, \dots, x_n] / I \]
corresponds to the projective subvariety of $\CP^n$
cut out by $I$ (when $I$ is semiprime).
In the general case of an arbitrary ideal $I$, we
call such schemes \vocab{projective subscheme} of $\CP^n$
(including such schemes as the ``double point'' $\Proj[x_0,x_1]/(x_0^2)$).


\chapter{More on Sheaves and Schemes}
sheafification

\chapter{Divisors and Line Bundles}

\end{document}



\section{(Aside) Which rings are coordinate rings?}
As an aside, we might ask: which rings are the coordinate ring of some affine variety?
There are some obvious requirements.
\begin{itemize}
	\ii Such ring must be $\CC$-algebras, of course.
	(A $\CC$-algebra is a ring that contains a copy of $\CC$ in it.)
	\ii Such a ring must be finitely generated, since $\CC[V]$
	is generated by $x_1$, \dots, $x_n$.
\end{itemize}
There is a third more subtle condition.
Define an element $r \in R$ to be \vocab{nilpotent} if $r^N = 0$ for some $r \in R$.
For example, $x$ is nilpotent in $\CC[x]/(x^{2015})$.
Call a ring \vocab{reduced} if it has no nonzero nilpotent elements.

\begin{exercise}
	Let $I$ be an ideal of a ring $R$.
	Show that $I$ is semiprime if and only if $R/I$ is reduced.
\end{exercise}
\begin{remark}
	For a ring $R$, this completes the following table:
	\begin{center}
	\begin{tabular}[h]{l|l}
		Ideal $I$ & Quotient $R/I$ \\ \hline
		Maximal & Field \\
		Prime & Integral Domain \\
		Semiprime & Reduced
	\end{tabular}
	\end{center}
	In particular, $(0)$ is maximal, prime, or semiprime
	if and only if $R/(0) \cong R$ is a field, integral domain, or reduced, respectively.
\end{remark}

Thus, the third requirement is that a coordinate ring must be reduced.
Conveniently, it turns out that these three conditions are sufficient!
\begin{theorem}[Coordinate Rings are Finitely Generated Reduced $\CC$-Algebras]
	Every finitely generated reduced $\CC$-algebra is the coordinate
	ring of some complex affine variety.
\end{theorem}
\begin{proof}
	Let $R$ be this map.
	Because it's finitely generated by some $r_1$, $r_2$, \dots, $r_n$,
	there is some surjective map
	\[ \CC[x_1, \dots, x_n] \surjto R \]
	via $x_i \mapsto r_i$.
	Let $I$ be the kernel of this map.
	Since $R$ is reduced, $I$ is radical.
	Then $R \cong \CC[V]$, where $V = \VV(I)$.
\end{proof}

