\chapter{Defining an affine scheme}
Now that we understand sheaves well,
we can define an affine scheme.
It will be a ringed space, so we need to define
\begin{itemize}
	\ii The set of points,
	\ii The topology on it, and
	\ii The structure sheaf on it.
\end{itemize}

\section{Some more advertising}
Let me describe what the construction of $\Spec A$ is going to do.

In the case of $\Aff^n$, we used $\CC^n$ as the set of points
and $\CC[x_1, \dots, x_n]$ as the ring of functions
but then remarked that the set of points
of $\CC^n$ corresponded to the maximal ideals of $\CC[x_1, \dots, x_n]$.
In an \emph{affine scheme}, we will take an \emph{arbitrary} ring $A$,
and generate the entire structure from just $A$ itself.
The final result is called $\Spec A$, the \vocab{spectrum} of $A$.
The affine varieties $\VV(I)$ we met earlier will just be
$\CC[x_1, \dots, x_n] / I$, but now we will be able to take
\emph{any} ideal $I$, thus finally completing the table at the end
of the ``affine variety'' chapter.

The construction of the affine scheme in this way
will have three big generalizations:
\begin{enumerate}
	\ii We no longer have to work over an algebraically
	closed field $\CC$, or even a field at all.
	This will be the most painless generalization:
	you won't have to adjust your current picture much for this to work.

	\ii We allow non-radical ideals:
	$\Spec \CC[x] / (x^2)$ will be the double point
	we sought for so long.
	This will let us formalize the notion of a ``fat'' or ``fuzzy'' point.

	\ii Our affine schemes will have so-called \emph{generic points}:
	points which you can visualize as floating around,
	somewhere in the space but nowhere in particular.
	(They'll correspond to prime non-maximal ideals.)
	These will take the longest to get used to,
	but once we discuss morphisms of schemes
	we will begin to see that these generic points actually make life
	\emph{easier}, once you get a sense of what they look like.
\end{enumerate}

\section{The set of points}
\prototype{$\Spec \CC[x_1, \dots, x_n] / I$.}

First surprise, for a ring $A$:
\begin{definition}
	The set $\Spec A$ is defined as the set of prime ideals of $A$.
\end{definition}

This might be a little surprising, since we might have guessed
that $\Spec A$ should just have the maximal ideals.
What do the remaining ideals correspond to?
The answer is that they will be so-called \emph{generic points}
points which are ``somewhere'' in the space, but nowhere in particular.

\begin{remark}
	As usual $A$ itself is not a prime ideal, but $(0)$
	is prime if $A$ is an integral domain.
\end{remark}

\begin{example}
	[Examples of spectrums]
	\listhack
	\begin{enumerate}[(a)]
		\ii $\Spec \CC[x]$ consists of a point $(x-a)$ for every $a \in \CC$,
		which correspond to what we geometrically think of as $\Aff^1$.
		In additionally consists of a point $(0)$,
		which we think of as a ``generic point'', nowhere in particular.

		\ii $\Spec \CC[x,y]$ consists of points $(x-a,y-b)$
		(which are the maximal ideals) as well as $(0)$ again, a generic
		point that is thought of as ``somewhere in $\CC^2$,
		but nowhere in particular''.
		It also consists of generic points corresponding to irreducible
		polynomials $f(x,y)$, for example $(y-x^2)$,
		which is a ``generic point on the parabola''.

		\ii If $k$ is a field, $\Spec k$ is a single point,
		since the only maximal ideal of $k$ is $(0)$.
	\end{enumerate}
\end{example}
\begin{example}
	[Complex affine varieties]
	Let $I \subseteq \CC[x_1, \dots, x_n]$ be an ideal.
	Then \[ \Spec \CC[x_1, \dots, x_n] /I \] contains a
	point for every closed irreducible subvariety of $\VV(I)$.
	So in addition to the ``geometric points'' we have
	``generic points'' along each of the varieties.
\end{example}
\begin{example}
	[More examples of spectrums]
	\listhack
	\begin{enumerate}[(a)]
		\ii $\Spec \ZZ$ consists of a point for every prime $p$,
		plus a generic point that is somewhere, but no where in particular.

		\ii $\Spec \CC[x] / (x^2)$ has only $(x)$ as a prime ideal.
		The ideal $(0)$ is not prime since $0 = x \cdot x$.
		Thus as a \emph{topological space},
		$\Spec \CC[x] / (x^2)$ is a single point.
		
		\ii $\Spec \Zc{60}$ consists of three points.
		What are they?
	\end{enumerate}
\end{example}

\section{The Zariski topology on the spectrum}
\prototype{Still $\Spec \CC[x_1, \dots, x_n] / I$.}

Now, we endow a topology on $\Spec A$.
Since the points on $\Spec A$ are the prime ideals, we continue
the analogy by thinking of the points $f$ as functions on $\Spec A$. That is,
\begin{definition}
	Let $f \in A$ and $\kp \in \Spec A$.
	Then the \vocab{value} of $f$ at $\kp$ is defined to be $f \pmod{\kp}$.
	We denote it $f(\kp)$.
\end{definition}
\begin{example}
	[Vanishing locii in $\Aff^n$]
	Suppose $A = \CC[x_1, \dots, x_n]$,
	and $\kp = (x_1-a_1, x_2-a_2, \dots, x_n-a_n)$ is a maximal ideal of $A$.
	Then for a polynomial $f \in \CC$,
	\[ f \pmod \kp = f(a_1, \dots, a_n) \]
	with the identification that $\CC/\kp \cong \CC$.
\end{example}
Indeed if you replace $A$ with $\CC[x_1, \dots, x_n]$
and $\Spec A$ with $\Aff^n$ in everything that follows,
then everything will be clear.

\begin{definition}
	Let $f \in A$. We define the \vocab{vanishing locus} of $f$ to be
	\[ \VV(f) = \left\{ \kp \in \Spec A \mid f(\kp) = 0 \right\}
		= \left\{ \kp \in \Spec A \mid f \in \kp \right\}. \]
	More generally, just as in the affine case,
	we define the vanishing locus for an ideal $I$ as
	\begin{align*}
		\VV(I) &= \left\{ \kp \in \Spec A \mid f(\kp)=0 \forall f \in I \right\} \\
		&= \left\{ \kp \in \Spec A \mid f \in \kp \; \forall f \in I \right\} \\
		&= \left\{ \kp \in \Spec A \mid I \subseteq \kp \right\}.
	\end{align*}
	Finally, we define the \vocab{Zariski topology} on $\Spec A$
	by declaring that the sets of the form $\VV(I)$ are closed.
\end{definition}

We now define a useful topological notion:
\begin{definition}
	A point $p \in X$ is a \vocab{closed point} if the set $\{p\}$ is closed.
\end{definition}
\begin{ques}
	[Important]
	Show that $\kp \in \Spec A$ is a closed point
	if and only if $\kp$ is a maximal ideal.
\end{ques}
Therefore the Zariski topology lets us refer back to the old ``geometric''
as just the closed points.
\begin{example}
	[Generic points, continued]
	Let $A = \CC[x,y]$ and let $\kp = (y-x^2) \in \Spec A$;
	this is the ``generic point'' on a parabola.
	It is not closed, but we can compute its closure:
	\[
		\ol{\{\kp\}}
		= \VV(\kp) = \left\{ \kq \in \Spec A \mid \kq \supseteq \kp \right\}.
	\]
	This closure contains the point $\kp$ as well
	as several maximal ideals $\kq$, such as $(x-2,y-4)$ and $(x-3,y-9)$.
	In other words, the closure of the ``generic point'' of the parabola
	is literally the set of all points that are actually on the parabola
	(including generic points).

	That means the way to picture $\kp$ is a point that 
	is ``somewhere on the parabola'', but nowhere in particular.
	It makes sense then that if we take the closure,
	we get the entire parabola,
	since $\kp$ ``could have been'' any of those points.
\end{example}

\begin{example}
	[The generic point of the $y$-axis isn't on the $x$-axis]
	Let $A = \CC[x,y]$ again.
	Consider $\VV(y)$, which is the $x$-axis of $\Spec A$.
	Then consider $\kp = (x)$, which is the generic point on the $y$-axis.
	Observe that
	\[ \kp \notin \VV(y). \]
	The geometric way of saying this is that a \emph{generic point}
	on the $y$-axis does not lie on the $x$-axis.
\end{example}

\section{A useless definition of the structure sheaf}
\prototype{Still $\CC[x_1, \dots, x_n] / I$.}

We have now endowed $\Spec A$ with the Zariski topology,
and so all that remains is to put a sheaf $\OO_{\Spec A}$ on it.
To do this we want a notion of ``regular functions'' as before.

This is easy to do since we have localizations on hand.
\begin{definition}
	First, let $\SF$ be the pre-sheaf of ``globally rational'' functions:
	i.e.\ we define $\SF(U)$ to be the localization
	\[
		\SF(U) = \left\{
			\frac fg \mid f, g \in A
			\text{ and } g(\kp) \neq 0 \; \forall \kp \in U
		\right\}
		= \left(A \setminus \bigcup_{\kp \in U} \kp \right)\inv A.
	\]
	We now define the structure sheaf on $\Spec A$.
	It is
	\[ \OO_{\Spec A} = \SF\sh \]
	i.e.\ the sheafification of the $\SF$ we just defined.
\end{definition}
\begin{exercise}
	Compare this with the definition for $\OO_V$
	with $V$ a complex variety, and check that they essentially match.
\end{exercise}
And thus, we have completed the transition to adulthood,
with a complete definition of the affine scheme.

If you really like compatible germs,
you can write out the definition:
\begin{definition}
	Let $A$ be a ring.
	Then $\Spec A$ is made into a ringed space by setting
	\[ \OO_{\Spec A}(U)
		= \left\{ (f_\kp \in A_\kp)_{\kp \in U}
		\text{ which are locally quotients} \right\}. \]
	That is, it consists of sequence $(f_\kp)_{\kp \in U}$, with
	each $f_\kp \in A_\kp$, such that for every point $\kp$ there
	is a neighborhood $U_\kp$ and an $f,g \in A$ such that
	$f_\kq = \frac fg \in A_\kq$ for all $\kq \in U_\kp$.
\end{definition}

We will now \textbf{basically forget about this definition},
because we will never use it in practice.
In the next two sections, we will show you how to compute
the stalks and sections of any affine scheme, without having
to think about sheafification.
(Hence the lack of examples in this section.)

\section{The stalks of the structure sheaf}
The stalks are the easy case,
and you probably can guess what's happening.

\begin{theorem}
	[Stalks of $\Spec A$ are $A_\kp$]
	Let $A$ be a ring and let $\kp \in \Spec A$.
	Then \[ \OO_{\Spec A, \kp} \cong A_\kp. \]
	In particular $X$ is a locally ringed space.
\end{theorem}
\begin{proof}
	Since sheafification preserved stalks,
	it's enough to check it for $\SF$ the pre-sheaf
	of globally rational functions in our definition.
	The proof is basically the same as \Cref{thm:stalks_affine_var}:
	there is an obvious map $\SF_\kp \to A_\kp$ on germs by
	\[ \left(U, f/g \in \SF(U) \right)
		\mapsto f/g \in A_\kp . \]
	(Note the $f/g$ on the left lives in $\SF(U)$
	but the one on the right lives in $A_\kp$).
	We show injectivity and surjectivity:
	\begin{itemize}
		\ii Injective: suppose $(U_1, f_1 / g_1)$ and $(U_2, f_2 / g_2)$
		are two germs with $f_1/g_1 = f_2/g_2 \in A_\kp$.
		This means $h(g_1 f_2 - f_2 g_1) = 0$ in $A$, for some nonzero $h$.
		Then both germs identify with
		the germ $(U_1 \cap U_2 \cap D(h), f_1 / g_1)$.
		\ii Surjective: let $U = D(g)$. \qedhere
	\end{itemize}
\end{proof}

\begin{example}
	[Denominators not divisible by $x$]
	We have seen this example so many times
	that I will only write it in the new notation,
	and make no further comment:
	if $X = \Spec \CC[x]$ then
	\[ \OO_{\Spec X, (x)} = \CC[x]_{(x)}. \]
\end{example}

If you want more examples,
take any of the ones from \Cref{sec:localize_prime_ideal},
and try to think about what they mean geometrically.

\section{The importance of distinguished open sets (aka the hyperbola effect matters)}
\prototype{Let $X = \Spec \CC[x] = \Aff^1$ and $U = D(x)$,
the line minus the origin.}

We will now really hammer in the importance of
the distinguished open sets.
The definition is analogous to before:
\begin{definition}
	Let $f \in \Spec A$.
	Then $D(f)$ is the set of $\kp$ such that $f(\kp) \neq 0$,
	a \vocab{distinguished open set}.
\end{definition}
Distinguished open sets will have three absolutely crucial properties,
which build on each ohter.

\subsection{A basis of the Zariski topology}
The first is a topological observation:
\begin{theorem}
	[Distinguished open sets form a base]
	The distinguished open sets $D(f)$
	form a basis for the Zariski topology:
\end{theorem}
\begin{proof}
	Let $U$ be an open set.
	It is the complement of some closed set
	$\VV(I) = \bigcap_{f \in I} V(f)$.
	Thus $U = \bigcup_{f \in I} D(f)$.
\end{proof}

\subsection{Sections are computable}
The second critical fact is that we can compute the relevant sections.
\begin{theorem}
	[Sections of distinguished open sets are nice]
	If $A$ is a ring and $f \in A$ then
	Then \[ \OO_{\Spec A}(D(f)) \cong A_f. \]
\end{theorem}
\begin{proof}
	Omitted, but similar to
	\Cref{thm:reg_func_distinguish_open}.
\end{proof}

\begin{example}
	[The punctured line is isomorphic to a hyperbola]
	The hyperbola effect now has a new notation too:
	\[ \OO_{\Spec \CC[x]} (D(x))
		= \CC[x]_{x} = \CC[x, x\inv]
		\cong \CC[x,y] / (xy-1). \]
\end{example}

The previous two results answer an important prayer:
how we can forget about sheafification.
\begin{moral}
	We can compute any section $\OO_X(U)$ in practice
	by using distinguished open sets and sheaf axioms.
\end{moral}
And thus we can forget about the original definition of $\OO_X$
which involved sheafification.
(This perspective is so useful that some sources,
like Vakil \cite[\S4.1]{ref:vakil}
will \emph{define} $\OO_{\Spec A}$
by requiring $\OO_{\Spec A}(D(f)) = A_f$.)

Here is a classical example; there are more coming.
\begin{example}
	[Punctured plane]
	Let $X = \Spec \CC[x,y]$,
	and consider the origin, the point $\km = (x,y)$.
	This ideal is maximal, so it corresponds to a closed point,
	and we can consider the open set $U$.
\end{example}
\todo{write me}

On a tangential note,
we had better also note somewhere that $\Spec A = D(1)$
is itself distinguished open, so the global sections can be recovered.
\begin{corollary}
	[$A$ is the ring of global sections]
	The ring of global sections of $\Spec A$ is $A$.
\end{corollary}
\begin{proof}
	By previous theorem, $\OO_{\Spec A}(\Spec A)
	= \OO_{\Spec A}(D(1)) = A_1 = A$.
\end{proof}

\subsection{They are affine}
The third final important fact is that
$D(f)$ will actually be \emph{isomorphic} to $\Spec A_f$
(just like the line minus the origin is isomorphic to the hyperbola).
We can't make this precise yet,
because we have not yet discussed morphisms of locally ringed space.
%However, you can already see this at the level of topological spaces;
%see \Cref{prob:homeomorphism}.
%Since distinguished open sets form a base,
%though, this means that open sets of affine schemes
%are, at least locally, themselves affine schemes:
%given any open set $U \subseteq \Spec A$, and point $\kp \in U$,
%there is some open neighborhood $V \ni p$ contained in $U$
%which is itself affine.

\section{Recap}
To recap, let $A$ be a ring.
\begin{itemize}
	\ii We define $X = \Spec A$ to be the set of prime ideals of $A$.
	\begin{itemize}
		\ii The maximal ideals are the ``closed points'' we are used to,
		but the prime ideals are ``generic points''.
	\end{itemize}

	\ii We equip $\Spec A$ with the Zariski topology by declaring
	$\VV(I)$ to be the closed sets, for ideals $I \subseteq A$.
	\begin{itemize}
		\ii The distinguished open sets $D(f)$,
		the complements of $\VV(f)$, form a topological basis.
	\end{itemize}

	\ii Finally, we defined a sheaf $\OO_X$.
	We set up the definition such that
	\begin{itemize}
		\ii $\OO_{X,\kp} = A_\kp$:
		the stalks are localizations at a prime.
		\ii $\OO_{X}(D(f)) = A_f$:
		at distinguished open sets $D(f)$,
		we get localizations too.
	\end{itemize}
	Since $D(f)$ is a basis,
	these two properties lets us explicitly compute $\OO_X(U)$
	for any open set $U$,
	so we don't have to resort to the definition using sheafification.
\end{itemize}

\section{A gazillion examples of affine schemes}
We now give an enormous list of examples.
Each example gets its own subsection,
rather than having page-long orange boxes.

\todo{mention Krull dimension}

\subsection{Example: $\Spec k$, a single point}

%%fakesection One-dimensional
\subsection{Example: $\Spec \CC[x]$, a one-dimensional line}
\subsection{Example: $\Spec \RR[x]$, a one-dimensional line with complex conjugates glued (no fear nullstellensatz)}
\subsection{Example: $\Spec k[x]$, over any ground field}
\subsection{Example: $\Spec \ZZ$, a one-dimensional scheme}

%% 0D from 2D
\subsection{Example: $\Spec k[x] / (x^2-x)$, a scheme with two points}
\subsection{Example: $\Spec k[x]/(x^2)$, the double point}
So, let me elaborate a little on the ``double point'' scheme
\[ X_2 = \Spec \CC[x] / (x^2) \]
since it is such an important motivating example.
How it does differ from the ``one-point'' scheme $X_1 = \Spec \CC[x] / (x)$?

The difference can only be seen on the level of the structure sheaves.
Indeed,
\begin{itemize}
	\ii As a set of points, $X_2$ has only one point, call it $p_2 = (x)$.
	Similarly, $X_1$ has only one point, call it $p_1 = (0)$.
	\ii The two Zariski topologies are the same
	(at any rate there is only one topology on a one-point space).
	\ii But at the structure sheaf level, $X_2$ has a ``bigger'' sheaf:
	the ring of functions on the single point $p_2$ is instead
	a \emph{two-dimensional} $\CC$-vector space $\CC[x]/(x^2)$.
	This formalizes the notion that this point is ``fat'':
	specifying a function from $p_2$ to $\CC$ now gives you
	\emph{two} degrees of freedom instead of just one.
\end{itemize}

Another way to think about is in terms of functions.
Consider polynomials $f = a_0 + a_1x + a_2x^2 + \dots$ on $\CC[x]$.
Then we have a sequence of maps
\begin{diagram}
	\CC[x] & \rTo & \CC[x]/(x^2) & \rTo & \CC[x] / (x) \\
	f & \rMapsto & a_0 + a_1x & \rMapsto & a_0
\end{diagram}
So $p_1$ only remembers the value of $f$, i.e.\ it remembers $f(0)$.
But the point $p_2$ remembers more than just the value of $f$:
it also remembers the first derivative of $f$.
In \cite{ref:vakil} one draws a picture of this by taking $0 \in \CC$
and adding a little bit of ``infinitesimal fuzz'' around it.

One can play the analogy more.
There's a ``triple point'' $X_3 = \Spec \CC[x] / (x^3) = \{p_3\}$
whose ring of functions has three degrees of freedom:
specifying a ``function'' on $p_3$ gives you three degrees of freedom.
Analogously, it remembers both the first and second derivatives 
of any polynomial in $\CC[x]$.
In \cite{ref:vakil}, this is ``the point $0$ with even more fuzz''.
Going even further,
$\CC[x,y] / (x^2,y)$ is ``the origin with fuzz in the $x$-direction'',
$\CC[x,y] / (x,y)^2$ is ``the origin with fuzz in all directions'',
and so on and so forth.

% \subsection{Example: $\Spec \Zc{49}$, a doubled $7$}

%% Two-dimensional
\subsection{Example: $\Spec \Zc{60}$, a scheme with three points}
\subsection{Example: $\Spec k[x,y]$, the two-dimensional plane}
\subsection{Example: $\Spec \ZZ[x]$, a strange two-dimensional scheme}

%% 1D cut out from 2D
\subsection{Example: $\Spec k[x,y]/(y-x^2)$, the parabola}
\subsection{Example: $\Spec k[x,y]/(xy)$, two axes}
\subsection{Example: $\Spec k[x] \times k[y]$, two ``parallel'' lines}

%% 1D with holes
\subsection{Example: $\Spec k[x]_x$, the punctured line (or hyperbola)}
\subsection{Example: $\Spec \ZZ_{55}$, deleting $5$ and $11$}

%% 0D --- stalks above 1D
\subsection{Example: $\Spec (k[x,y]/(xy))_{x+y}$, two axes with the origin deleted}

\subsection{Example: $\Spec k[x]_{(x)}$, the stalk above the origin}
\subsection{Example: $\Spec k[x]_{(0)}$, the stalk above the generic point}
\subsection{Example: $\Spec \ZZ_{(5)}$, the stalk above $(5)$}
\subsection{Example: $\Spec \ZZ_{(0)} = \Spec \QQ$}
\subsection{Example: $\Spec k[x,y]_{(x,y)}$, the stalk above the origin}
\subsection{Example: $\Spec k[x,y]_{(y-x^2)}$, the stalk above the parabola}
\subsection{Example: $\Spec k[x,y]_{(0)}$, the stalk above the generic point}

\section\problemhead

\begin{problem}
	Describe the points of $\Spec \QQ[x]$.
	\begin{hint}
		Galois conjugates.
	\end{hint}
\end{problem}
\todo{punctured dreidel}

\begin{dproblem}
	[Chinese remainder theorem]
	Consider $X = \Spec \Zc{60}$, which as a topological space has three points.
	By considering $\OO_X(X)$ prove the Chinese theorem
	\[ \Zc{60} \cong \Zc{4} \times \Zc{3} \times \Zc{5}. \]
	\begin{hint}
		Appeal to \Cref{prob:finite_sheaf}.
	\end{hint}
\end{dproblem}

\begin{problem}
	[From Andrew Critch]
	\gim
	Let $A$ be a Noetherian ring.
	Show that $A$ is an integral domain if and only if it has no idempotents,
	and $A_\kp$ is an integral domain for every prime $\kp$.
	\begin{hint}
		Show that if $\Spec R$ is connected and its stalks are irreducible,
		then $\Spec R$ is itself irreducible.
		Consider nilradical $N = \sqrt{(0)}$.
	\end{hint}
	\begin{sol}
		This is the proposition on the second page of
		\url{http://www.acritch.com/media/math/Stalk-local_detection_of_irreducibility.pdf}
	\end{sol}
\end{problem}
