\chapter{The Frobenius Endomorphism}
We keep our setup: $\pp$ lies above $p$ in $\OO_K$.
Picture:
\begin{diagram}
	K & \supset & \OO_K & \pp & & \OO_K / \pp \cong \FF_{p^f} \\
	\dLine && \dLine & \dLine & & \dLine \\
	\QQ & \supset & \ZZ & (p) & & \FF_p
\end{diagram}

Assume now that $p$ is unramified, so we have our isomorphism
\[ D_\pp \taking\theta \Gal\left( (\OO_K/\pp) / \FF_p \right). \]
Recall that $\theta$ sends $\sigma \in D_\pp$
to the map \[ \theta(\sigma) : \alpha \pmod\pp \mapsto \sigma(\alpha) \pmod\pp. \]
Since $\sigma$ is supposed to fix $\pp$, this is well-defined.

Again, we already know $\Gal\left( (\OO_K/\pp)/\FF_p \right)$,
according to the string of isomorphisms
\[
	\Gal\left( (\OO_K/\pp) / \FF_p \right)
	\cong \Gal\left( \FF_{p^f} / \FF_p \right)
	\cong \left< x \mapsto x^p \right>
	\cong \ZZ_{f} .
\]
If we take the generator of $\ZZ_f$, we get the so-called \emph{Frobenius element},
which will turn out to be absurdly powerful.

Throughout this chapter $K/\QQ$ is a Galois extension with Galois group $G$,
$p$ is an \emph{unramified} rational prime in $K$, and $\pp$ is a prime above it.

\section{Frobenius Endomorphisms}
Let me draw the picture before I say what I'm going to do:
\begin{center}
	\begin{asy}
		size(12cm);
		filldraw( (-4,-2)--(-4,2)--(1.5,2)--(1.5,-2)--cycle, lightblue+opacity(0.2), black);
		label("$G = \operatorname{Gal}(K/\mathbb Q)$", (-1,2), dir(90));
		dot( (-1.1,-1.2) );
		dot( (-1.4,0.9) );
		dot( (-2,1.4) );
		dot( (-2.7,-0.4) );
		dot( (-3.1,0.2) );
		dot( (-3.4,-1.6) );

		filldraw(scale(0.8,1.8)*unitcircle, lightcyan+opacity(0.4), black);
		label("$D_{\mathfrak p}$", (0.8,2), dir(-90));
		for (real y=-1.5; y<2; ++y) { dot( (0,y) ); }
		label("$\operatorname{Frob}_{\mathfrak p}$", (0,-1.5), dir(90));

		filldraw(shift(5,0)*scale(0.8,1.8)*unitcircle, lightcyan+opacity(0.4), black);
		for (real y=0.5; y<2; ++y) { dot( (5,y) ); }
		dot("$T$", (5,-1.5), dir(45));
		dot("$T^2$", (5,-0.5), dir(45));
		draw( (1,0)--(4,0), Arrows );
		label("$\mathbb Z_f = \left<T \mid T^f=1\right>$", (5,1.8), dir(90));

		draw( (0.2,-1.5)--(4.8,-1.5), dashed, EndArrow);
		label("$\theta(\operatorname{Frob}_{\mathfrak p}) = T$", (2.8,-1.5), dir(-90));
		label("$\theta$", (2.5,0), dir(90));
		label("$\cong$", (2.5,0), dir(-90));
	\end{asy}
\end{center}
The point is to take the generator in $\ZZ_f$ and see who it goes to in $G$ under $\theta$.
We distinguish this element as $\Frob_\pp$.
The following theorem makes this all precise:
\begin{theorem}[The Frobenius Element]
	Assume $K/\QQ$ is Galois with Galois group $G$.
	Let $p$ be a rational prime unramified in $K$, and $\pp$ a prime above it.
	There is a \emph{unique} element $\Frob_\pp \in G$
	with the property that
	\[ \Frob_\pp(\alpha) \equiv \alpha^{p} \pmod{\pp}. \]
	It is called the \vocab{Frobenius endomorphism} at $\pp$, and has order $f$.
\end{theorem}
\begin{proof}
	First, observe:
	\begin{ques}
	Show that such an element must be in $D_\pp$.
	\end{ques}
	Now $\theta(\sigma)$ has the property if and only if it equals $T$,
	so everything is clear from the isomorphism $\theta$.
\end{proof}

The \emph{uniqueness} part is pretty important:
it allows us to show that a given $\sigma$ is actually \emph{equal}
to the generator of $\Gal(K/\QQ)$ by just observing that it satisfies
the above functional equation.
We'll use this more than once in the proof of quadratic reciprocity.

\begin{example}[Frobenius Elements of the Gaussian Integers]
	Let's actually compute some Frobenius elements for $K = \QQ(i)$,
	which has $\OO_K = \ZZ[i]$.
	This is a Galois extension, with $G = \Zm2$, corresponding to the identity
	and complex conjugation.
	\begin{enumerate}[(a)]
		\ii Let $p \equiv 1 \pmod 4$.
		Then $(p) = (a+bi)(a-bi)$ in $\ZZ[i]$; set $\pp = a + bi$.
		so $\OO_K / \pp \cong \FF_p$.
		So in this case the Galois group $\Gal( (\OO_K/\pp) / \FF_p )$
		is trivial, and as predicted we have $D_\pp$ trivial as well.
		Thus $\Frob_\pp = \id$.
		\ii Now let $p \equiv 3 \pmod 4$, and let $\pp = (p)$.
		Then $\OO_K / \pp \cong \FF_p[i] \cong \FF_{p^2}$, and the Galois group has order $2$;
		accordingly, $D_\pp$ has order $2$, and its generator is $\Frob_\pp$.

		So $\sigma = \Frob_\pp$ has order $2$, and it must be complex conjugation.
		We can see this directly as well: $\sigma$ is the unique element such that
		\[ (a+bi)^p \equiv \sigma(a+bi) \pmod{\pp} \]
		in $\ZZ[i]$.
		For $a=0$ and $b=1$, we get $\sigma(i) \equiv i^p \equiv -i \pmod{\pp}$,
		and so $\sigma$ must be complex conjugation.
	\end{enumerate}
\end{example}

\section{Conjugacy Classes}
Now suppose $\pp_1$ and $\pp_2$ are \emph{two} primes above an unramified rational prime $p$.
Then we can define $\Frob_{\pp_1}$ and $\Frob_{\pp_2}$.
Since the Galois group acts transitively,
we can select $\sigma \in \Gal(K/\QQ)$ be such that
\[ \sigma(\pp_1) = \pp_2. \]
We claim that
\[
	\Frob_{\pp_2} = \sigma \circ \Frob_{\pp_1} \circ \sigma\inv.
\]
Note that this is an equation in $G$.
\begin{ques}
	Prove this.
\end{ques}

More generally, for a given unramified rational prime $p$, we obtain the following:
\begin{theorem}
	[Conjugacy Classes in Galois Groups]
	The set
	\[ \left\{ \Frob_\pp \mid \pp \text{ above } p \right\} \]
	is one of the conjugacy classes of $G$.
\end{theorem}
\begin{proof}
	We've used the fact that $G = \Gal(K/\QQ)$ is transitive
	to show that $\Frob_{\pp_1}$ and $\Frob_{\pp_2}$ are conjugate
	if they both lie above $p$; hence it's \emph{contained} in some
	conjugacy class.
	So it remains to check that for any $\pp$, $\sigma$,
	we have $\sigma \circ \Frob_\pp \circ \sigma\inv = \Frob_{\pp'}$
	for some $\pp'$. For this, just take $\pp' = \sigma\pp$.
	Hence the set is indeed a conjugacy class.
\end{proof}
%We denote the conjugacy class by the \vocab{Frobenius symbol}
%\[ \left( \frac{K/\QQ}{p} \right). \]

In summary,
\begin{moral}
	$\Frob_{\pp}$ is determined up to conjugation by the prime $p$
	from which $\pp$ arises.
\end{moral}
So even the Gothic letters look scary, the content of $\Frob_{\pp}$
really just comes from the more friendly-looking rational prime $p$.


\begin{example}
	[Frobenius Elements in $\QQ(\cbrt2,\omega)$]
	With those remarks, here is a more involved example of a Frobenius map.
	Let $K = \QQ(\cbrt2, \omega)$ be the splitting field of 
	\[ t^3-2 = (t-\cbrt2)(t-\omega\cbrt2)(t-\omega^2\cbrt2). \]
	We've seen in an earlier example that
	\[ \OO_K = \ZZ[\eps] \quad\text{where}\quad \eps \text { is a root of } t^6+3t^5-5t^3+3t+1. \]
	We factor $5$ as the prime
	\[ (5) = (5, \eps^2+\eps+2)(5, \eps^2+3\eps+3)(5, \eps^2+4\eps+1). \]

	Take the first one, $\mathfrak P = (5, \eps^2+\eps+2)$.
	It follows that \[ \OO_K / {\mathfrak P} \cong \FF_5[\eps] / (\eps^2+\eps+2). \]
	As this field has $5^2=25$ elements,
	the Galois group of this guy over $\FF_5$ is order $2$.
	Thus $D_\pp \cong \Zm 2$ as well and $\sigma = \Frob_{\mathfrak P}$ will have order $2$.

	Note that $\Gal(K/\QQ) \cong S_3$ is just the $3!=6$
	permutations of the three roots $\{\cbrt2,\omega\cbrt2,\omega^2\cbrt2\}$.
	Exactly three of these have order $2$,
	and they correspond to the three prime ideals of $5$;
	each of the three Frobenius elements from $5$ correspond to
	fixing one of the roots and swapping the other two.
	In still other words, the conjugacy class associated to $5$
	is the cycle type $(\bullet)(\bullet \; \bullet)$ in $S_3$.
\end{example}


\section{Cheboratev Density Theorem}
Natural question: can we represent every conjugacy class in this way?
In other words, is every element of $G$ equal to $\Frob_\pp$ for some $\pp$?

Miraculously, not only is the answer ``yes'', but in fact it does so in the nicest way possible:
the $\Frob_\pp$'s are ``equally distributed'' when we pick a random $\pp$.
\begin{theorem}
	[Cheboratev Density Theorem over $\QQ$]
	Let $C$ be a conjugacy class of $G = \Gal(K/\QQ)$.
	The density of (unramified) primes $p$ such that $\{ \Frob_\pp \mid \pp \text{ above } p \} = C$
	%\[ \left( \frac{K/\QQ}{p} \right) = C \]
	is exactly $\left\lvert C \right\rvert / \left\lvert G \right\rvert$.
	In particular, for any $\sigma \in G$ there are infinitely many rational primes $p$
	with $\pp$ above $p$ so that $\Frob_{\pp} = \sigma$.
\end{theorem}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{media/back-to-future-density.png}
	\caption{From a pretty excellent movie\dots}
\end{figure}


By density, I mean that the proportion of primes $p \le x$ that work 
approaches $\frac{\left\lvert C \right\rvert}{\left\lvert G \right\rvert}$ as $x \to \infty$.
Note that I'm throwing out the primes that ramify in $K$.
This is no issue, since the only primes that ramify are those dividing $\Delta_K$,
and we can throw those out.

In other words, if I pick a random prime $p$ and look at the resulting conjugacy class,
it's a lot like throwing a dart at $G$:
the probability of hitting any conjugacy class depends just on the size of the class.
\begin{center}
	\begin{asy}
		size(8cm);
		bigbox("$G$");
		pen b = lightcyan + opacity(0.4);
		pen k = black;
		filldraw( (-2.6,2.5)--(0.6,2.5)--(0.6,0.5)--(-2.6,0.5)--cycle, b, k);
		filldraw( (-2.6,-2.5)--(0.6,-2.5)--(0.6,-0.5)--(-2.6,-0.5)--cycle, b, k);
		filldraw( (2,0)--(3.5,0)--(3.5,2.5)--(2,2.5)--cycle, b, k);
		filldraw( (2,-1)--(3.5,-1)--(3.5,-2)--(2,-2)--cycle, b, k);
		for (real x = -2; x < 1; ++x) {
			dot( (x, 1.9) ); 
			dot( (x, 1.1) ); 
			dot( (x, -1.9) ); 
			dot( (x, -1.1) ); 
		}
		label("$37.5\%$", (-2.6, 0.5), dir(140));
		label("$37.5\%$", (-2.6,-2.5), dir(140));
		label("$C_1$", (-2.6, 2.5), dir(225));
		label("$C_2$", (-2.6, -.5), dir(225));
		dot( (2.75, 2.0) );
		dot( (2.75, 1.25) );
		dot( (2.75, 0.50) );
		dot( (2.75, -1.50) );
		label("$C_3$", (2, 0), dir(-90));
		label("$18.75\%$", (3, 0), dir(-75));
		label("$C_4$", (2, -2), dir(-90));
		label("$6.25\%$", (3, -2), dir(-75));
	\end{asy}
\end{center}

\begin{remark}
Happily, this theorem also works if we replace $K/\QQ$ with any Galois extension $K/F$;
in that case we replace ``$\pp$ over $p$'' with ``$\mathfrak P$ over $\pp$''.
In that case, we use $\Norm(\pp) \le x$ rather than $p \le x$ as the way
to define density.
\end{remark}

\section{Example: Frobenius Elements of Cyclotomic Fields}
Let $q$ be a prime, and consider $L = \QQ(\zeta_q)$, with $q$ a primitive $q$th root of unity.
You should recall from various starred problems that
\begin{itemize}
	\ii $\Delta_L = \pm q^{q-2}$,
	\ii $\OO_L = \ZZ[\zeta_q]$, and
	\ii The map $\sigma_n : \zeta_q \mapsto \zeta_q^n$ is an automorphism of $L$ whenever $\gcd(n,q)=1$,
	and depends only on $n \pmod q$.
	In other words, the automorphisms of $L/\QQ$ just shuffle around the $q$th roots of unity.
	In fact the Galois group consists exactly of the elements $\{\sigma_n\}$, namely
	\[ \Gal(L/\QQ) = \{ \sigma_n \mid n \not\equiv 0 \pmod q \}. \]
	As a group, \[ \Gal(L/\QQ) = \Zm q \cong \ZZ_{q-1}. \]
\end{itemize}
This is surprisingly nice, because \textbf{elements of $\Gal(L/\QQ)$ look
a lot like Frobenius endomorphisms already}.
So we shouldn't be surprised if the Frobenius endomorphisms of $\Gal(L/\QQ)$
have a concrete description.

Let $p$ be a rational prime other than $q$, so $p$ doesn't ramify (since $p \nmid \Delta_L$).
Then $\pp$ is above it, and there is a Frobenius element $\Frob_\pp$ uniquely determined by the property
\[ \Frob_\pp(\alpha) \equiv \alpha^p \pmod{\pp}. \]

\begin{lemma}[Cyclotomic Frobenius Elements]
	\label{lem:cyclo_frob}
	In the cyclotomic setting, \[ \Frob_\pp = \sigma_p. \]
\end{lemma}
\begin{proof}
	We know $\Frob_\pp(\alpha) \equiv \alpha^p \pmod{\pp}$ by definition,
	but also that $\Frob_\pp = \sigma_n$ for some $n$
	We want $n=p$; since $\sigma_n(\zeta_q)^n = \zeta_q^n$ by definition
	it would be very weird if this wasn't true!
	
	Given $\zeta_q^n \equiv \zeta_q^p \pmod{\pp}$, it suffices to
	prove that the $q$th roots of unity are distinct mod $\pp$.
	Look at the polynomial $F(x) = x^q-1$ in $\ZZ[\zeta_p]/\pp \cong \FF_{p^f}$.
	Its derivative is \[ F'(x) = qx^{q-1} \not\equiv 0 \pmod{\pp} \]
	(since $\FF_{p^f}$ has characteristic $p \nmid q$).
	The only root of $F'$ is zero, hence $F$ has no double roots mod $\pp$.
\end{proof}

\section{Frobenius Elements Behave Well With Restriction}
Consider the following setup, where $L/\QQ$ and $K/\QQ$ are both Galois extensions:
\begin{diagram}
	L & \supseteq & \mathfrak P & \rDotted & \Frob_{\mathfrak P} \in \Gal(L/\QQ)\\
	\dLine && \dLine && \\
	K & \supseteq & \mathfrak p & \rDotted & \Frob_\pp \in \Gal(K/\QQ) \\
	\dLine && \dLine && \\
	\QQ & \supseteq & (p) &&
\end{diagram}
Here $\mathfrak p$ is above $(p)$ and $\mathfrak P$ is above $\mathfrak p$.
We may define
\[ \Frob_\pp : K \to K
\quad\text{and}\quad
\Frob_{\mathfrak P} : L \to L \]
and want to know how these are related.

\begin{theorem}
	[Restrictions of Frobenius Elements]
	Assume $L/\QQ$ and $K/\QQ$ are both Galois.
	The restriction of $\Frob_{\mathfrak P}$ to $K$ is $\Frob_{\pp}$,
	i.e.\ for every $\alpha \in K$,
	\[ \Frob_\pp(\alpha) = \Frob_{\mathfrak P}(\alpha). \]
\end{theorem}
\begin{proof}
	We know
	\[ \Frob_{\mathfrak P}(\alpha) \equiv \alpha^p \pmod{\mathfrak P} \quad \forall \alpha \in \OO_L \]
	from the definition.
	\begin{ques}
		Deduce that
		\[ \Frob_{\mathfrak P}(\alpha) \equiv \alpha^p \pmod{\pp} \quad \forall \alpha \in \OO_K. \]
		(This is weaker than the previous statement in two ways!)
	\end{ques}
	Thus $\Frob_{\mathfrak P}$ restricted to $\OO_K$ satisfies the
	characterizing property of $\Frob_\pp$.
\end{proof}
In short, the point of this section is that
\begin{moral}
	Frobenius elements upstairs restrict to Frobenius elements downstairs.
\end{moral}

\section{Application: Quadratic Reciprocity}
We now aim to prove the following result from elementary number theory.
(See, e.g. \cite{ref:holden} for an exposition on quadratic reciprocity,
if you're not familiar with it.)
\begin{theorem}
	[Quadratic Reciprocity]
	Let $p$ and $q$ be distinct odd primes.
	Then
	\[ \left( \frac pq \right)\left( \frac qp \right)
		= (-1)^{\frac{p-1}{2} \cdot \frac{q-1}{2}}. \]
\end{theorem}

\subsection*{Step 1: Setup}
For this proof, we first define
\[ L = \QQ(\zeta_q) \]
where $\zeta_q$ is a primitive $q$th root of unity.
Then $L/\QQ$ is Galois, with Galois group $G$.
\begin{ques}
	Show that $G$ has a unique subgroup $H$ of order two.
\end{ques}
In fact, we can describe it exactly: viewing $G \cong \Zm q$, we have
\[ H = \left\{ \sigma_n \mid \text{$n$ quadratic residue mod $q$} \right\}. \]
By the Fundamental Theorem of Galois Theory, there ought to be a degree $2$
extension of $\QQ$ inside $\QQ(\zeta_q)$ (that is, a quadratic field).
Call it $\QQ(\sqrt{q^\ast})$, for $q^\ast$ squarefree:
\begin{diagram}
	L = \QQ(\zeta_q) & \rIsom & \{1\} \\
	\dLine^{\frac{q-1}{2}} && \dLine \\
	K = \QQ(\sqrt{q^\ast}) & \rIsom & H \\
	\dLine^2 && \dLine \\
	\QQ & \rIsom & G \\
\end{diagram}
\begin{exercise}
	Note that if a rational prime $\ell$ ramifies in $K$,
	then it ramifies in $L$.\footnote{
		Actually, it is true in general that given a tower $L/K/\QQ$,
		we have $\Delta_K$ divides $\Delta_L$.}
	Use this to show that
	\[ q^\ast = \pm q \text{ and } q^\ast \equiv 1 \pmod 4. \]
	Together these determine the value of $q^\ast$.
\end{exercise}

\subsection*{Step 2: Reformulation}
Now we are going to prove:
\begin{theorem}
	[Quadratic Reciprocity, Equivalent Formulation]
	For distinct odd primes $p$, $q$ we have
	\[ \left( \frac pq \right) = \left( \frac{q^\ast}{p} \right). \]
\end{theorem}
\begin{exercise}
	Using the fact that $\left( \frac{-1}{p} \right) = (-1)^{\frac{p-1}{2}}$,
	show that this is equivalent to quadratic reciprocity as we know it.
\end{exercise}

We look at the rational prime $p$ in $\ZZ$.
Either it splits into two in $K$ or is inert; either way let $\pp$ be a prime factor
in the resulting decomposition (so $\pp$ is either $p \cdot \OO_K$ in the inert case,
or one of the primes in the split case).
Then let ${\mathfrak P}$ be above $\pp$.
It could possibly also split in $K$: the picture looks like
\begin{diagram}
	\OO_L = \ZZ[\zeta_q] & \supset {\mathfrak P} & \rDotted & \ZZ[\zeta_p]/{\mathfrak P} \cong \FF_{p^f} \\
	\OO_K = \ZZ[\frac{1+\sqrt{q^\ast}}{2}] & \supseteq \pp & \rDotted & \FF_p \text{ or } \FF_{p^2} \\
	\ZZ & \supseteq (p) & \rDotted & \FF_p
\end{diagram}
\begin{ques}
	Why is $p$ not ramified in either $K$ or $L$?
\end{ques}

\subsection*{Step 3: Introducing the Frobenius}
Now, we take the Frobenius 
\[ \sigma_p = \Frob_{\mathfrak P} \in \Gal(L/\QQ). \]
We claim that
\[ \Frob_{\mathfrak P} \in H \iff \text{$p$ splits in $K$}. \]
To see this, note that $\Frob_{\mathfrak P}$ is in $H$ if and only if it acts
as the identity on $K$.
But $\Frob_{\mathfrak P}$ restricted to $K$ is $\Frob_\pp$!
So \[ \Frob_{\mathfrak P} \in H \iff \Frob_\pp = \id_K. \]
So we simply note that $\Frob_\pp$ has order $1$ if $p$ splits (and $\pp$ has inertial degree $1$)
and order $2$ if $p$ is inert (hence $\pp = p \cdot \OO_K$ has inertial degree $2$).
After all, $\Frob_\pp$ corresponds to the generator of
\[ \Gal( (\OO_K/\pp) / \FF_p) \cong \Gal(\FF_p/\FF_p) \text{ or } \Gal(\FF_{p^2}/\FF_p) \]
according to whether $p$ splits or is inert, respectively.

\subsection*{Finishing Up}
We already know by \Cref{lem:cyclo_frob} that $\Frob_{\mathfrak P} = \sigma_p \in H$
if and only if $p$ is a quadratic residue.
On the other hand,
\begin{exercise}
	Show that $p$ splits in $\OO_K = \ZZ[\frac12(1+\sqrt{q^\ast})]$
	if and only if $\left( \frac{q^\ast}{p} \right) = 1$.
	(Use the factoring algorithm. You need the fact that $p \neq 2$ here.)
\end{exercise}
In other words
\[ \left( \frac pq \right) = 1
	\iff \sigma_p \in H \iff \text{$p$ splits in $\ZZ\left[ \tfrac12(1+\sqrt{q^\ast}) \right]$}
	\iff \left( \frac{q^\ast}{p} \right) = 1.
\]
This completes the proof.


\section{Frobenius Elements Control Factorization}
\prototype{$\Frob_\pp$ controlled the splitting of $p$ in the proof of quadratic reciprocity;
the same holds in general.}
In the proof of quadratic reciprocity, we used the fact that Frobenius elements behaved
well with restriction in order to relate the splitting of $p$ with properties of $\Frob_\pp$.

In fact, there is a much stronger statement for
any intermediate field $\QQ \subseteq E \subseteq K$
which works even if $E/\QQ$ is not Galois.
It relies on the notion of a \emph{factorization pattern}.
Here is how it goes.

Set $n = [E:\QQ]$, and let $p$ be a rational prime unramified in $K$.
Then $p$ can be broken in $E$ as
\[ p \cdot \OO_E = \pp_1 \pp_2 \dots \pp_g \]
with inertial degrees $f_1$, \dots, $f_g$:
(these inertial degrees might be different since $E/\QQ$ isn't Galois).
The numbers $f_1 + \dots + f_g = n$ form a partition of the number $n$.
For example, in the quadratic reciprocity proof we had $n = 2$,
with possible partitions $1 + 1$ (if $p$ split) and $2$ (if $p$ was inert).
We call this the \vocab{factorization pattern} of $p$ in $E$.

Next, we introduce a Frobenius $\Frob_{\mathfrak P}$ above $(p)$, all the way in $K$;
this is an element of $G = \Gal(K/\QQ)$.
Then let $H$ be the group corresponding to the field $E$.
Diagram:
\begin{diagram}
	K & \rIsom & \{1\} && \Frob_{\mathfrak P} & \\
	\dLine && \dLine &&& \\
	E & \rIsom & H && \pp_1 \dots \pp_g & \qquad f_1 + \dots + f_g = n \\
	\dLine^n && \dLine_n && \dLine & \\
	\QQ & \rIsom & G && (p) &
\end{diagram}
Then $\Frob_{\mathfrak P}$ induces a \emph{permutation}
of the $n$ left cosets $gH$ by left multiplication
(after all, $\Frob_{\mathfrak P}$ is an element of $G$ too!).
Just as with any permutation, we may look at the resulting cycle decomposition,
which has a natural ``cycle structure'': a partition of $n$.
\begin{center}
	\begin{asy}
		size(8cm);
		pen tg = heavyred; // "times g"

		pointpen = lightblue;
		pointfontpen = pointpen;
		pair A = Drawing("g_1H", dir(80), dir(80));
		pair B = Drawing("g_2H", A*dir(120), A*dir(120));
		pair C = Drawing("g_3H", A*dir(240), A*dir(240));
		draw(A--B, dashed + pointpen, EndArrow, Margin(2,2));
		draw(B--C, dashed + pointpen, EndArrow, Margin(2,2));
		draw(C--A, dashed + pointpen, EndArrow, Margin(2,2));
		label("$\times g$", midpoint(A--B), A+B, tg);
		label("$\times g$", midpoint(B--C), B+C, tg);
		label("$\times g$", midpoint(C--A), C+A, tg);
		label("$3$", origin, origin, pointfontpen);
		add(shift( (-3.2,0.1) ) * CC());

		label("$g = \operatorname{Frob}_{\mathfrak P}$", (-1.7,1.7), origin, tg);

		pointpen = heavygreen;
		pointfontpen = pointpen;
		pair W = Drawing("g_4H", dir(50), dir(50));
		pair X = Drawing("g_5H", W*dir(90), W*dir(90));
		pair Y = Drawing("g_6H", W*dir(180), W*dir(180));
		pair Z = Drawing("g_6H", W*dir(270), W*dir(270));
		draw(W--X, dashed + pointpen, EndArrow, Margin(2,2));
		draw(X--Y, dashed + pointpen, EndArrow, Margin(2,2));
		draw(Y--Z, dashed + pointpen, EndArrow, Margin(2,2));
		draw(Z--W, dashed + pointpen, EndArrow, Margin(2,2));
		defaultpen(red);
		label("$\times g$", W--X, W+X, tg);
		label("$\times g$", X--Y, X+Y, tg);
		label("$\times g$", Y--Z, Y+Z, tg);
		label("$\times g$", Z--W, Z+W, tg);
		label("$4$", origin, origin, pointfontpen);

		label("$\boxed{n = 7 = 3+4}$", (-2,-1.8), origin, black);
	\end{asy}
\end{center}

The theorem is that these coincide:
\begin{theorem}
	[Frobenius Elements Control Decomposition]
	\label{thm:frob_control_decomp}
	Let $\QQ \subseteq E \subseteq K$ an extension of number fields
	and assume $K/\QQ$ is Galois (though $E/\QQ$ need not be).
	Pick an unramified rational prime $p$; let $G = \Gal(K/\QQ)$
	and $H$ the corresponding intermediate subgroup.
	Finally, let $\mathfrak P$ be a prime above $p$ in $K$.

	Then the \emph{factorization pattern} of $p$ in $E$ is given by
	the \emph{cycle structure} of $\Frob_{\mathfrak P}$ acting on the left cosets of $H$.
\end{theorem}
Often, we take $E = K$, in which case this is just asserting
that the decomposition of the prime $p$ is controlled by a Frobenius element over it.

An important special case is when $E = \QQ(\alpha)$,
because as we will see it is let us determine how the minimal
polynomial of $\alpha$ factors modulo $p$.
To motivate this, let's go back a few chapters
and think about the Factoring Algorithm.

Let $\alpha$ be an algebraic integer and $f$ its minimal polynomial (of degree $n$).
Set $E = \QQ(\alpha)$ (which has degree $n$ over $\QQ$).
Suppose we're lucky enough that $\OO_E = \ZZ[\alpha]$,
i.e. that $E$ is monogenic.
Then we know by the Factoring Algorithm,
to factor any $p$ in $E$, all we have to do is factor $f$ modulo $p$,
since if $f = f_1^{e_1} \dots f_g^{e_g} \pmod p$ then we have
\[ (p) = \prod_i \pp_i = \prod_i (f_i(\alpha), p)^{e_i}. \]
This gives us complete information about the ramification indices and inertial degrees;
the $e_i$ are the ramification indices, and $\deg f_i$ are the inertial degrees
(since $\OO_E / \pp_i \cong \FF_p[X] / (f_i(X))$).

In particular, if $p$ is unramified then all the $e_i$ are equal to $1$, and we get
\[ n = \deg f = \deg f_1 + \deg f_2 + \dots + \deg f_g. \]
Once again we have a partition of $n$;
we call this the \vocab{factorization pattern} of $f$ modulo $p$.
So, to see the factorization pattern of an unramified $p$ in $\OO_E$,
we just have to know the factorization pattern of the $f \pmod p$.

Turning this on its head, if we want to know the factorization pattern of $f \pmod p$,
we just need to know how $p$ decomposes.
And it turns out these coincide even without the assumption that $E$ is monogenic.

\begin{theorem}[Frobenius Controls Polynomial Factorization]
	\label{thm:factor_poly_frob}
	Let $\alpha$ be an algebraic integer with minimal polynomial $f$,
	and let $E = \QQ(\alpha)$.
	Then for any prime $p$ unramified in the splitting field $K$ of $f$,
	the following coincide:
	\begin{enumerate}[(i)]
		\ii The factorization pattern of $p$ in $E$.
		\ii The factorization pattern of $f \pmod p$.
		\ii The cycle structure associated to the action
		of $\Frob_{\mathfrak P} \in \Gal(K/\QQ)$ on the roots of $f$,
		where $\mathfrak P$ is above $p$ in $K$.
	\end{enumerate}
\end{theorem}
\begin{example}[Factoring $x^3-2 \pmod 5$]
	Let $\alpha = \cbrt2$ and $f = x^3-2$, so $E = \QQ(\cbrt2)$.
	Set $p=5$ and let finally, let $K = \QQ(\cbrt2, \omega)$ be the splitting field.
	Setup:
	\begin{diagram}
		K = \QQ(\cbrt2, \omega) && \mathfrak P && x^3-2 = (x-\cbrt2)(x-\cbrt2\omega)(x-\cbrt2\omega^2) \\
		\dLine~2 && \dLine \\
		E = \QQ(\sqrt[3]{2}) && \pp && x^3-2 = (x-\cbrt2)(x^2+\cbrt2x+\cbrt4) \\
		\dLine~3 && \dLine \\
		\QQ && (5) && x^3-2 \text{ irreducible over } \QQ
	\end{diagram}
	The three claimed objects now all have shape $2+1$:
	\begin{enumerate}[(i)]
		\ii By the Factoring Algorithm, we have
		$(5) = (5, \cbrt2-3)(5, 9+3\cbrt2+\cbrt4)$.
		\ii We have $x^3-2 \equiv (x-3)(x^2+3x+9) \pmod 5$.
		\ii We saw before that $\Frob_{\mathfrak P} = (\bullet)(\bullet \; \bullet)$.
	\end{enumerate}
\end{example}

\begin{proof}[Sketch of Proof]
	Letting $n = \deg f$.
	Let $H$ be the subgroup of $G = \Gal(K/\QQ)$ corresponding to $E$, so $[G:E] = n$.
	Pictorially, we have
	\begin{diagram}
		K && \{1\} && \mathfrak P \\
		\dLine && \dLine && \dLine \\
		E = \QQ(\alpha) && H && \pp \\
		\dLine && \dLine && \dLine \\
		\QQ && G && (p)
	\end{diagram}
	We claim that (i), (ii), (iii) are all equivalent to
	\begin{center}
		(iv) The pattern of the action of $\Frob_{\mathfrak P}$ on the $G/H$.
	\end{center}
	In other words we claim the cosets correspond to the $n$ roots of $f$ in $K$.
	Indeed $H$ is just the set of $\tau \in G$ such that $\tau(\alpha)=\alpha$,
	so there's a bijection between the roots and the cosets $G/H$
	by $\tau H \mapsto \tau(\alpha)$.
	Think of it this way: if $G = S_n$, and $H = \{\tau : \tau(1) = 1\}$,
	then $G/H$ has order $n! / (n-1)! = n$ and corresponds to the elements $\{1, \dots, n\}$.
	So there is a natural bijection from (iii) to (iv).

	The fact that (i) is in bijection to (iv) was the previous theorem,
	\Cref{thm:frob_control_decomp}.
	The correspondence (i) $\iff$ (ii) is a fact of Galois theory,
	so we omit the proof here.
\end{proof}

All this can be done in general with $\QQ$ replaced by $F$;
for example, in \cite{ref:lenstra_chebotarev}.

\section{Example Application: IMO 2003 Problem 6}
As an example of the power we now have at our disposal, let's prove:

\begin{center}
	\begin{minipage}{4.5cm}
		\includegraphics[width=4cm]{media/IMO-2003-logo.png}
	\end{minipage}%
	\begin{minipage}{10cm}
		\textbf{Problem 6}.
		Let $p$ be a prime number.
		Prove that there exists a prime number $q$ such that for every integer $n$,
		the number $n^p-p$ is not divisible by $q$.
	\end{minipage}
\end{center}
We will show, much more strongly, that there exist infinitely many primes $q$
such that $X^p-p$ is irreducible.

\begin{proof}[Solution]
	Okay! First, we draw the tower of fields
	\[ \QQ \subseteq \QQ(\sqrt[p]{p}) \subseteq K \]
	where $K$ is the splitting field of $f(x) = x^p-p$.
	Let $E = \QQ(\sqrt[p]{p})$ for brevity and note it has degree $[E:\QQ] = p$.
	Let $G = \Gal(K/\QQ)$.
	\begin{ques}
		Show that $p$ divides the order of $G$. (Look at $E$.)
	\end{ques}
	Hence by Cauchy's Theorem (\Cref{thm:cauchy_group}, which is a purely group-theoretic fact)
	we can find a $\sigma \in G$ of order $p$.
	By Cheboratev, there exist infinitely many rational (unramified) primes $q \neq p$
	and primes $\mathfrak Q \subseteq \OO_K$ above $q$
	such that $\Frob_{\mathfrak Q} = \sigma$.
	(Yes, that's an uppercase Gothic $Q$. Sorry.)

	We claim that all these $q$ work.

	By \Cref{thm:factor_poly_frob}, the factorization of $f \pmod q$ is
	controlled by the action of $\sigma = \Frob_{\mathfrak Q}$ on the roots of $f$.
	But $\sigma$ has prime order $p$ in $G$!
	So all the lengths in the cycle structure have to divide $p$.
	Thus the possible factorization patterns of $f$ are
	\[ p = \underbrace{1 + 1 + \dots + 1}_{\text{$p$ times}}
	\quad\text{or}\quad p = p. \]
	So we just need to rule out the $p = 1 + \dots + 1$ case now:
	this only happens if $f$ breaks into linear factors mod $q$.
	Intuitively this edge case seems highly unlikely (are we really so unlucky
	that $f$ factors into \emph{linear} factors when we want it to be irreducible?).
	And indeed this is easy to see: this means that $\sigma$ fixes all
	of the roots of $f$ in $f$, but that means $\sigma$ fixes $K$,
	and hence is the identity of $G$, contradiction.
\end{proof}
\begin{remark}
	In fact $K = \QQ(\sqrt[p]{p}, \zeta_p)$, and $\left\lvert G \right\rvert = p(p-1)$.
	With a little more group theory, we can show that in fact the density of
	primes $q$ that work is $\frac 1p$.
\end{remark}

\section\problemhead

\begin{problem}
	Show that for an odd prime $p$, \[ \left( \frac 2p \right) = (-1)^{\frac 18(p^2-1)}. \]
	\begin{hint}
		Modify the end of the proof of quadratic reciprocity.
	\end{hint}
	\begin{sol}
		It is still true that
		\[ \left( \frac 2q \right) = 1
		\iff \sigma_2 \in H \iff \text{$2$ splits in $\ZZ\left[ \tfrac12(1+\sqrt{q^\ast}) \right]$}. \]
		Now, $2$ splits in the ring if and only if $t^2 - t - \tfrac14(1-q^\ast)$
		factors mod $2$. This happens if and only if $q^\ast \equiv 1 \pmod 8$.
		One can check this is exactly if $q \equiv \pm 1 \pmod 8$, which gives the conclusion.
	\end{sol}
\end{problem}

\begin{problem}
	Let $f$ be a nonconstant polynomial with integer coefficients.
	Suppose $f \pmod p$ splits completely into linear factors
	for all sufficiently large primes $p$.
	Show that $f$ splits completely into linear factors.
\end{problem}

\begin{dproblem}
	[Dirichlet's Theorem on Arithmetic Progressions]
	Let $a$ and $m$ be relatively prime positive integers.
	Show that the density of primes $p \equiv a \pmod m$ is exactly $\frac{1}{\phi(m)}$.
	\begin{hint}
		Cheboratev Density on $\QQ(\zeta_m)$.
	\end{hint}
	\begin{sol}
		Let $K = \Gal(\QQ(\zeta_m)/\QQ)$.
		One can show that $\Gal(K/\QQ) \cong \Zm m$ exactly as before.
		In particular, $\Gal(K/\QQ)$ is abelian and therefore its conjugacy classes
		are singleton sets; there are $\phi(m)$ of them.

		As long as $p$ is sufficiently large, it is unramified
		and $\sigma_p = \Frob_\pp$ for any $\pp$ above $p$
		(as $m$th roots of unity will be distinct modulo $p$;
		differentiate $x^m-1$ mod $p$ again).
	\end{sol}
\end{dproblem}

\begin{problem}
	Let $n$ be an odd integer which is not a prime power.
	Show that the $n$th cyclotomic polynomial is not
	irreducible modulo \emph{any} rational prime.
	% http://mathoverflow.net/questions/12366/how-many-primes-stay-inert-in-a-finite-non-cyclic-extension-of-number-fields
\end{problem}
